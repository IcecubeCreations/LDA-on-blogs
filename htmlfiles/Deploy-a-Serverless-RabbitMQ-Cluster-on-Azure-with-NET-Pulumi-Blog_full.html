<!doctype html><html lang=en-us prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=/js/bundle.473172dace2a336e369888b6ec4349cc21cf7661e74efe3f3259d409a352fb5d.js defer></script>
<link rel=stylesheet href=/css/bundle.ffaed9d47af15c793bf33c5f23a13bc5215e731f3f7e5405df17c792df4f15e1.css></link><meta name=google-site-verification content="N-ezSTIu4P3bSc4TqidV4wWCkMzFiMN269ZgDYArGkk"><meta property="og:image" content="https://www.pulumi.com/blog/rabbitmq-azure/1.png"><meta property="og:type" content="article"><meta property="og:url" content="https://www.pulumi.com/blog/rabbitmq-azure/"><meta property="og:site_name" content="pulumi"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@PulumiCorp"><meta name=twitter:creator content="@ItayPodhajcer"><meta property="og:title" content="Deploy a Serverless RabbitMQ Cluster on Azure with .NET"><meta name=description content="Deploying a Geo-Redundant Serverless RabbitMQ Cluster on Azure Using Pulumi for .NET"><meta property="og:description" content="Deploying a Geo-Redundant Serverless RabbitMQ Cluster on Azure Using Pulumi for .NET"><meta class=swiftype name=title data-type=string content="Blog: Deploy a Serverless RabbitMQ Cluster on Azure with .NET"><title>Deploy a Serverless RabbitMQ Cluster on Azure with .NET | Pulumi Blog</title><link rel=icon type=image/x-icon href=/images/favicon.ico><link rel=canonical href=https://www.pulumi.com/blog/rabbitmq-azure/><link rel=alternate type=application/rss+xml href=https://www.pulumi.com/blog/rss.xml title="Pulumi Blog"><script src=https://js.sentry-cdn.com/02614bf2f18e4615a73218b810563ced.min.js crossorigin=anonymous></script>
<script>Sentry.onLoad(function(){Sentry.init({environment:"production",release:"push-9e967a41"})})</script><script async defer src=https://buttons.github.io/buttons.js></script>
<script>!function(){var e=window.analytics=window.analytics||[],t,n;if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"],e.factory=function(t){return function(){var n=Array.prototype.slice.call(arguments);return n.unshift(t),e.push(n),e}};for(t=0;t<e.methods.length;t++)n=e.methods[t],e[n]=e.factory(n);e.load=function(s,o){var t=document.createElement("script"),n;t.type="text/javascript",t.async=!0,t.src="https://cdn.segment.com/analytics.js/v1/"+s+"/analytics.min.js",n=document.getElementsByTagName("script")[0],n.parentNode.insertBefore(t,n),e._loadOptions=o},e.SNIPPET_VERSION="4.1.0",e.load("UK90Ofwacetj5VCPJ7cUgkbNcKLSHO3u"),e.page()}}()</script><script>(function(){var e=document.createElement("script"),t;e.type="text/javascript",e.async=!0,e.referrerPolicy="unsafe-url",e.src="https://ws.zoominfo.com/pixel/61f9917376ed81001a80e653",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script><script async defer src=//cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js></script>
<script>window.addEventListener("load",function(){anchors&&anchors.add("h1:not(.no-anchor), h2:not(.no-anchor), h3:not(.no-anchor), h4:not(.no-anchor), h5:not(.no-anchor), h6:not(.no-anchor)")})</script></head><body class=section-blog><pulumi-root></pulumi-root><nav class="top-nav-bar transition-all"><div class="top-nav-container lg:container lg:px-4"><div class=top-nav-banner-cta-container><div class=top-nav-banner-cta><a href=/blog/pulumi-universal-iac/ class=top-nav-banner-cta-text>Pulumi Infrastructure as Code Goes Universal.
<span class=underline>Read about our new launches</span>.</a></div></div><ul class="hidden w-full lg:flex lg:w-1/2 justify-end items-center order-first lg:order-last"><li class="github-widget mr-8"><a data-track=header-github-pulumi class=github-button href=https://github.com/pulumi/pulumi data-size=small data-show-count=true aria-label="Star pulumi/pulumi on GitHub">Star</a></li><li class=mr-8><a data-track=header-slack href=https://slack.pulumi.com/ target=_blank><i class="fab fa-slack"></i>
Slack</a></li><li class=mr-8><a data-track=header-docs href=/docs/><i class="fas fa-book mr-0.5"></i>
Docs</a></li><li class=mr-8><a data-track=header-registry href=/registry/><i class="fas fa-archive mr-0.5"></i>
Registry</a></li><li><a data-track=header-console href=https://app.pulumi.com/ target=_blank><i class="fas fa-user-circle"></i>
Sign In</a></li></ul></div></nav><div class=header-container><nav class="lg:container lg:mx-auto lg:px-4"><header><div class="flex flex-col lg:flex-row"><div class=logo-container><a data-track=header-pulumi-logo class=block href=/><img class="normal-logo h-8" src=/images/logo/logo-on-white.svg alt="Pulumi logo">
<img class="dark-logo hidden h-8" src=/images/logo/logo-on-black.svg alt="Pulumi logo"></a></div><ul class=desktop-menu><li class=header-nav-item-drop-down><span class="dropdown-title whitespace-nowrap">Cloud Engineering</span>
<span class=dropdown-menu-caret></span><div class=header-nav-drop-down-menu><ul><div><div class=header-nav-drop-down-heading>Cloud Engineering</div><div class=header-nav-drop-down-sub-heading>Software engineering practices made for the cloud</div></div><div class=header-nav-one-col-drop-down><li><div class=list-title><a href=/cloud-engineering/><i class="fas fa-book-open fa-fw"></i>
Overview<div class=list-sub-title>Learn best practices for cloud engineering</div></a></div></li><li><div class=list-title><a href=/cloud-engineering-summit/><i class="fas fa-mountain fa-fw"></i>
2021 Summit<div class=list-sub-title>Attend a virtual day of learning</div></a></div></li><li><div class=list-title><a href=/solutions/><i class="fas fa-lightbulb fa-fw"></i>
Solutions<div class=list-sub-title>Explore ways to apply cloud engineering</div></a></div></li><li><div class=list-title><a href=/enterprise/><i class="fas fa-building fa-fw"></i>
Enterprises<div class=list-sub-title>Learn how Pulumi serves enterprise needs</div></a></div></li><li><div class=list-title><a href=/case-studies/><i class="fas fa-file fa-fw"></i>
Case Studies<div class=list-sub-title>Read how customers are innovating faster</div></a></div></li></div></ul></div></li><li class=header-nav-item-drop-down><span class=dropdown-title>Product</span>
<span class=dropdown-menu-caret></span><div class="header-nav-drop-down-menu product"><ul><div><div class=header-nav-drop-down-heading>Product</div><div class=header-nav-drop-down-sub-heading>Learn about the open source Pulumi Platform and managed Pulumi Service</div></div><div class=header-nav-two-col-drop-down><li><div class=list-title><a href=/product/><i class="fas fa-folder fa-fw"></i>
Pulumi Overview<div class=list-sub-title>Open source, infrastructure as code for Node.js, Python, Go, .NET, Java, and YAML</div></a></div></li><li><div class=list-title><a href=/product/pulumi-service/><i class="fas fa-user-cog fa-fw"></i>
Pulumi Service<div class=list-sub-title>Managed service for adopting Pulumi open source at scale.
Use SaaS or self-host</div></a></div></li><li><div class=list-title><a href=/docs/reference/pulumi-sdk/><i class="fas fa-database fa-fw"></i>
SDK & Engine
                         <div class=list-sub-title>Provision and manage infrastructure on any cloud
interactively with a CLI</div></a></div></li><li><div class=list-title><a href=/docs/guides/continuous-delivery/><i class="fas fa-sync fa-fw"></i>
CI/CD Integrations<div class=list-sub-title>Deliver infrastructure code through your existing delivery
system</div></a></div></li><li><div class=list-title><a href=/automation/><i class="fas fa-cog fa-fw"></i>
Automation API<div class=list-sub-title>Provision and manage cloud infrastructure on any cloud
with a programmatic interface</div></a></div></li><li><div class=list-title><a href=/crossguard/><i class="fas fa-file-code fa-fw"></i>
Policy as Code<div class=list-sub-title>Enforce guardrails for security and compliance using policies
in standard languages</div></a></div></li><li><div class=list-title><a href=/product/packages/><i class="fas fa-cubes fa-fw"></i>
Pulumi Packages<div class=list-sub-title>Use building blocks and reusable architectures to build
& deploy infrastructure on any cloud</div></a></div></li><li></li></div></ul></div></li><li><a href=/pricing/>Pricing</a></li><li><a href=/docs/>Docs</a></li><li class=header-nav-item-drop-down><span class=dropdown-title>Learn</span>
<span class=dropdown-menu-caret></span><div class="header-nav-drop-down-menu learn"><ul><div><div class=header-nav-drop-down-heading>Learn</div><div class=header-nav-drop-down-sub-heading>Find tutorials, how-to guides, and resources to deepen your Pulumi knowledge</div></div><div class=header-nav-two-col-drop-down><li><div class=list-title><a href=/blog/><i class="fas fa-blog fa-fw"></i>
Blog<div class=list-sub-title>Read product news, best practices, and more</div></a></div></li><li><div class=list-title><a href=/learn/><i class="fas fa-chalkboard-teacher fa-fw"></i>
Learn Pulumi<div class=list-sub-title>Get hands-on with Pulumi concepts</div></a></div></li><li><div class=list-title><a href=/case-studies/><i class="fas fa-file fa-fw"></i>
Case Studies<div class=list-sub-title>Read how customers are innovating faster</div></a></div></li><li><div class=list-title><a href=/resources/><i class="fas fa-cogs fa-fw"></i>
Resources<div class=list-sub-title>Videos, upcoming sessions, PulumiTV and more</div></a></div></li><li><div class=list-title><a href=/resources/#upcoming><i class="fas fa-users fa-fw"></i>
Workshops<div class=list-sub-title>Register for upcoming sessions</div></a></div></li><li></li><li><div class=list-title><a href=/learn/glossary/><i class="fas fa-cloud fa-fw"></i>
Cloud Engineering Glossary<div class=list-sub-title>Learn the lingo of Pulumi</div></a></div></li></div></ul></div></li></ul><input class=mobile-menu-toggle type=checkbox id=mobile-menu name=mobile-menu>
<span class=mobile-menu-icon><label class=mobile-menu-closed for=mobile-menu><span><svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="6" y="9" width="24" height="2" rx="1" fill="#2f3032"/><rect x="6" y="17" width="24" height="2" rx="1" fill="#2f3032"/><rect x="6" y="25" width="24" height="2" rx="1" fill="#2f3032"/></svg></span></label><label class="mobile-menu-open hidden" for=mobile-menu><span><svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="10.2219" y="8.80762" width="24" height="2" rx="1" transform="rotate(45 10.2219 8.80762)" fill="#2f3032"/><rect x="8.80762" y="25.7781" width="24" height="2" rx="1" transform="rotate(-45 8.80762 25.7781)" fill="#2f3032"/></svg></span></label></span><ul class=mobile-menu><ul><li class="mobile-menu-item whitespace-nowrap"><a href=/cloud-engineering/>Cloud Engineering</a></li><li class=mobile-menu-subitem><a href=/cloud-engineering/>Overview</a></li><li class=mobile-menu-subitem><a href=/cloud-engineering-summit/>2021 Summit</a></li><li class=mobile-menu-subitem><a href=/solutions/>Solutions</a></li><li class=mobile-menu-subitem><a href=/enterprise/>Enterprises</a></li><li class=mobile-menu-subitem><a href=/case-studies/>Case Studies</a></li><li class=mobile-menu-item><a href=/product/>Product</a></li><li class=mobile-menu-subitem><a href=/product/>Pulumi Overview</a></li><li class=mobile-menu-subitem><a href=/docs/reference/pulumi-sdk/>SDK & Engine</a></li><li class=mobile-menu-subitem><a href=/automation/>Automation API</a></li><li class=mobile-menu-subitem><a href=/product/packages/>Pulumi Packages</a></li><li class=mobile-menu-subitem><a href=/product/pulumi-service/>Pulumi Service</a></li><li class=mobile-menu-subitem><a href=/docs/guides/continuous-delivery/>CI/CD Integrations</a></li><li class=mobile-menu-subitem><a href=/crossguard/>Policy as Code</a></li><li class=mobile-menu-item><a href=/pricing/>Pricing</a></li><li class=mobile-menu-item><a href=/docs/>Docs</a></li><li class=mobile-menu-item><a href=#>Learn</a></li><li class=mobile-menu-subitem><a href=/blog/>Blog</a></li><li class=mobile-menu-subitem><a href=/learn/>Learn Pulumi</a></li><li class=mobile-menu-subitem><a href=/resources/>Resources</a></li><li class=mobile-menu-subitem><a href=/resources/#upcoming>Workshops</a></li><li class=mobile-menu-subitem><a href=/learn/glossary/>Cloud Engineering Glossary</a></li></ul><div class="flex items-center justify-between py-4 px-2 border-t my-4 mx-2 border-gray-200"><a href=https://github.com/pulumi/pulumi>GitHub</a>
<a href=https://slack.pulumi.com/>Slack</a>
<a href=/docs/>Docs</a>
<a href=/registry/>Registry</a>
<a href=https://app.pulumi.com/>Sign In</a></div><div class="text-center bg-violet-600 text-white py-4"><a class=block data-track=header-get-started-mobile href=/docs/get-started/ title="Get started with Pulumi by creating your first project">Get Started</a></div></ul><div class=cta-container><a class=header-btn-primary data-track=header-get-started href=/docs/get-started/ title="Get started with Pulumi by creating your first project">Get Started</a></div></div></header></nav></div><div class=pulumi-up-stars></div><main><div class="container mx-auto px-4 py-8"><div class=xxl:flex><div class="flex flex-col lg:flex-row xxl:w-9/12"><div class="lg:w-1/4 xxl:w-4/12 pr-8"><aside class="lg:pr-8 sticky-sidebar"><div class=lg:hidden><button class="blog-sidebar-toggle items-center px-3 py-2 border rounded text-purple border-purple">
Toggle Blog Navigation</button></div><h2 class="no-anchor hidden lg:flex mt-2 mb-6"><a data-track=sidebar class=text-2xl href=/blog/>Pulumi Blog</a></h2><div class="blog-sidebar-content hidden lg:block"><script type=text/javascript>(function(e,o,i,a,t,n,s){e.SwiftypeObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)})(window,document,"script","//s.swiftypecdn.com/install/v2/st.js","_st"),_st("install","xxxQB1LC9DE212h8eJmh","2.0.0")</script><div id=search-container><div id=search-form><form class="relative flex"><i class="fas fa-search absolute inset-y-0 flex items-center pl-3 text-gray-500"></i>
<input id=search-query type=text class="st-default-search-input py-2 px-4 pl-8 text-sm border border-gray-400 focus:border-blue-500 focus:outline-none rounded transition" placeholder="Search the blog"></form></div><div id=search-results class=relative></div></div><script>const observer=new MutationObserver((e)=>{e.forEach(e=>{e.addedNodes.forEach(e=>{e.classList.contains("st-ui-result")&&!e.href.includes("blog")&&e.remove()})})});observer.observe(document.querySelector("#search-container #search-results"),{attributes:!1,childList:!0,subtree:!0})</script><hr class=my-8><div class=my-8><h5 class="no-anchor text-gray-800 pb-2">Program the Cloud</h5><div class=text-sm><p class="my-0 text-gray-700">Create, deploy, and manage cloud infrastructure using your favorite language.</p><p class=mb-0><a class=whitespace-nowrap data-track=sidebar href=/docs/get-started/>Get started &rarr;</a></p></div></div><hr class=my-8><div class=my-4><h5 class=no-anchor>Recent Posts</h5><ul class="list-none p-0"><li class="my-4 leading-snug"><a data-track=recent-post class=text-sm href=https://www.pulumi.com/blog/stack-readme/>Stack READMEs in the Pulumi Service</a></li><li class="my-4 leading-snug"><a data-track=recent-post class=text-sm href=https://www.pulumi.com/blog/meals-for-ukraine/>Teaming up to help deliver more meals to Ukraine</a></li><li class="my-4 leading-snug"><a data-track=recent-post class=text-sm href=https://www.pulumi.com/blog/pulumi-universal-iac/>Pulumi Universal IaC: New Support For Java, YAML and AWS CDK</a></li><li class="my-4 leading-snug"><a data-track=recent-post class=text-sm href=https://www.pulumi.com/blog/announcing-infrastructure-as-code-with-java-and-pulumi/>Announcing Infrastructure as Code with Java and Pulumi</a></li><li class="my-4 leading-snug"><a data-track=recent-post class=text-sm href=https://www.pulumi.com/blog/pulumi-yaml/>Pulumi YAML: A Simple Declarative Interface for Pulumi</a></li><li class="my-4 leading-snug"><a data-track=recent-post class=text-sm href=https://www.pulumi.com/blog/crosswalk-for-aws-all-languages/>Announcing Crosswalk for AWS in all Pulumi Languages</a></li><li class="my-4 leading-snug"><a data-track=recent-post class=text-sm href=https://www.pulumi.com/blog/aws-cdk-on-pulumi/>Introducing AWS CDK on Pulumi</a></li><li class="my-4 leading-snug"><a data-track=recent-post class=text-sm href=https://www.pulumi.com/blog/announcing-pulumi-service-provider/>Announcing the Pulumi Service Provider</a></li><li class="my-4 leading-snug"><a data-track=recent-post class=text-sm href=https://www.pulumi.com/blog/five-years-of-infrastructure-as-code/>Five Years of Infrastructure as Code</a></li></ul></div><hr class=my-8><ul class="list-none p-0 mb-4 inline-flex flex-wrap text-xs"><li><a data-track=blog-tag-.net class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/.net/>.net</a></li><li><a data-track=blog-tag-aks class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/aks/>aks</a></li><li><a data-track=blog-tag-architecture-as-code class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/architecture-as-code/>architecture-as-code</a></li><li><a data-track=blog-tag-automation-api class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/automation-api/>automation-api</a></li><li><a data-track=blog-tag-aws class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/aws/>aws</a></li><li><a data-track=blog-tag-azure class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/azure/>azure</a></li><li><a data-track=blog-tag-cloud-engineering class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/cloud-engineering/>cloud-engineering</a></li><li><a data-track=blog-tag-cloud-native class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/cloud-native/>cloud-native</a></li><li><a data-track=blog-tag-community class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/community/>community</a></li><li><a data-track=blog-tag-containers class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/containers/>containers</a></li><li><a data-track=blog-tag-continuous-delivery class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/continuous-delivery/>continuous-delivery</a></li><li><a data-track=blog-tag-development-environment class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/development-environment/>development-environment</a></li><li><a data-track=blog-tag-docker class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/docker/>docker</a></li><li><a data-track=blog-tag-ecs class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/ecs/>ecs</a></li><li><a data-track=blog-tag-eks class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/eks/>eks</a></li><li><a data-track=blog-tag-features class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/features/>features</a></li><li><a data-track=blog-tag-fundamentals class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/fundamentals/>fundamentals</a></li><li><a data-track=blog-tag-github-actions class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/github-actions/>github-actions</a></li><li><a data-track=blog-tag-go class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/go/>go</a></li><li><a data-track=blog-tag-google-cloud class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/google-cloud/>google-cloud</a></li><li><a data-track=blog-tag-guest-post class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/guest-post/>guest-post</a></li><li><a data-track=blog-tag-infrastructure-as-code class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/infrastructure-as-code/>infrastructure-as-code</a></li><li><a data-track=blog-tag-javascript class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/javascript/>javascript</a></li><li><a data-track=blog-tag-kubernetes class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/kubernetes/>kubernetes</a></li><li><a data-track=blog-tag-lambda class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/lambda/>lambda</a></li><li><a data-track=blog-tag-learn class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/learn/>learn</a></li><li><a data-track=blog-tag-migration class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/migration/>migration</a></li><li><a data-track=blog-tag-packages class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/packages/>packages</a></li><li><a data-track=blog-tag-policy-as-code class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/policy-as-code/>policy-as-code</a></li><li><a data-track=blog-tag-pulumi-enterprise class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/pulumi-enterprise/>pulumi-enterprise</a></li><li><a data-track=blog-tag-pulumi-events class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/pulumi-events/>pulumi-events</a></li><li><a data-track=blog-tag-pulumi-interns class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/pulumi-interns/>pulumi-interns</a></li><li><a data-track=blog-tag-pulumi-news class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/pulumi-news/>pulumi-news</a></li><li><a data-track=blog-tag-python class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/python/>python</a></li><li><a data-track=blog-tag-secrets class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/secrets/>secrets</a></li><li><a data-track=blog-tag-security class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/security/>security</a></li><li><a data-track=blog-tag-serverless class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/serverless/>serverless</a></li><li><a data-track=blog-tag-testing class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/testing/>testing</a></li><li><a data-track=blog-tag-typescript class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/typescript/>typescript</a></li><li><a data-track=blog-tag-virtual-machines class="tag tag-blog text-xs" href=https://www.pulumi.com/blog/tag/virtual-machines/>virtual-machines</a></li></ul></div><div class="lg:hidden pb-4"></div></aside></div><div class="lg:w-3/4 xxl:w-9/12"><article class="mb-8 pb-8 border-b border-gray-200"><h1 class=no-anchor>Deploy a Serverless RabbitMQ Cluster on Azure with .NET</h1><p>Posted on <time>Thursday, Jul 16, 2020</time><div class="flex items-center"><span class="text-sm text-gray-700"><span class="flex items-center"><span class="flex items-center"><a data-track=itay-podhajcer-img class="rounded-full p-1 bg-blue-200 mr-2" href=https://www.pulumi.com/blog/author/itay-podhajcer/><img class="w-8 rounded-full" src=/images/team/itay-podhajcer.jpg alt="Itay Podhajcer" title="Itay Podhajcer"></a>
<a data-track=itay-podhajcer-name class="mr-2 hover:text-gray-800" href=https://www.pulumi.com/blog/author/itay-podhajcer/>Itay Podhajcer</a></span></span></span></div><section data-swiftype-index=true><p>Itay Podhajcer is Chief Architect at Velocity Career Labs and a highly experienced software development and technology professional, consultant, architect & project manager. He shared his article on building an Azure serverless cluster for deploying RabbitMQ with C#. The original article was published <a href=https://medium.com/microsoftazure/deploying-a-geo-redundant-serverless-rabbitmq-cluster-on-azure-using-pulumi-for-net-71e6b417378d>here</a>.</p><p><img src=1.png alt=Graphic><br></p><p>Pulumi, an open source cloud development platform that supports multiple languages and platforms, allows programming and managing cloud environments using a consistent model and the power of full programming languages.</p><p>One of those supported languages is C#, which we will be using to deploy a geo-redundant serverless cluster of the well-known messaging solution RabbitMQ. To run the cluster, we will be using three regions, in which we will be deploying:</p><ul><li>Two peered virtual networks, one internal for the containers, and one external for connecting to the other regions. Two networks are required because (at least at the writing of this article) Azure Container Instances only support one peered network, so to overcome that, we will be peering the network with the containers with an additional network in the region, which in turn, connects with the external networks from the other regions.</li><li>A RabbitMQ node using Azure Container Instances that will be deployed in the internal virtual network.</li><li>An Azure Firewall, which will be deployed in the external virtual network, acting as a network virtual appliance (NVA) with rules for forwarding traffic between the internal node and the other regions.</li><li>Route tables with routes that will enable the inter-network transfer of data.</li><li>A storage account with file shares for maintaining the nodeâs state.</li></ul><p>Additionally, as we will be using RabbitMQâs DNS based cluster peer discovery mechanism, we will also be deploying at the global level:</p><ul><li>DNS zone for the nodeâs A records and the discovery record required by RabbitMQ.</li><li>A reverse DNS zone for the PTR records of the nodes required by RabbitMQ.</li></ul><figure><img src=2.png><figcaption><h4>Geo-redundant serverless RabbitMQ cluster</h4></figcaption></figure><h2 id=prerequisites>Prerequisites</h2><p>As we will be using Pulumi for .NET to deploy to Azure, we will need the following installed on our workstation:</p><ul><li>Azure CLI: installation guide is available <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">here</a>.</li><li>.N ET Core SDK: download is available <a href=https://dotnet.microsoft.com/download>here</a>.</li><li>Pulumi: installation guide is available <a href=https://www.pulumi.com/docs/get-started/install/>here</a>.</li></ul><h2 id=example-repository>Example Repository</h2><p>The complete example of deploying the RabbitMQ cluster can be downloaded or cloned for the following GitHub repository:</p><p><a href=https://github.com/cladular/pulumi-rabbitmq-azure><img src=repo.png alt="Github link"></a><br></p><p>When running <code>pulumi up</code> you will be asked to create a stack (you can use whatever you here like <code>Example</code>) and set a passphrase (you can leave it empty and press enter as there are no stored secrets in this stack).</p><h2 id=setup-the-project>Setup the Project</h2><p>After all the required tools are installed, we can start by creating the empty Pulumi project running <code>pulumi new azure-csharp</code> inside an empty folder. Set a name for the project (like <code>Example</code>), a description (like <code>RabbitMQ Serverless Cluster</code>), a stack name (like <code>Example</code>), a passphrase (you can use an empty one and just press enter as we wonât be storing secrets in the stack) and an Azure location (just use the default).</p><p>Now that we have an initial project, we will also add the <code>Pulumi.Random</code> package to the project by running the command <code>dotnet add package Pulumi.Random</code>, as we will be using it to generate the cluster sec, And rename the <code>MyStack</code> class and file to <code>ExampleStack</code> (it also needs to be changed inside <code>Program.cs</code> which holds the code that triggers the deployment of the stack).</p><p>Lastly, we call <code>dotnet restore</code> to also download the <code>Pulumi.Azure</code> package that was included in the project when it was created.</p><h2 id=writing-the-stack>Writing the Stack</h2><p>We will start by defining a few constants, the constructor, an empty method called <code>Stack()</code>, which will be called by the constructor to start creating the resources and a property named <code>Cookie</code>, which will hold the clusterâs secret, decorated with the <code>Output</code> attribute to let Pulumi know that the value needs to be printed out once the deployment is complete:</p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/7552af98323ce6685e85b07ba67b1598.js></script><p>Now that we have our initial class, we can start writing methods for the resources we will be creating:</p><ul><li>Resource groups:<br><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/4c57e537f0d9cc15b801035d556c2504.js></script><br></li><li>Private DNS zone:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/52af6ba0a8f1a92d5352c3218505eefa.js></script><br></p><ul><li>Private reverse DNS zone:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/dbb6e125fe7d55ba79a2d09f4a13cfa2.js></script><br></p><ul><li>Random string for the RabbitMQ cluster secret:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/f737d38ea91e446233d295ebb3b80766.js></script><br></p><ul><li>DNS zone links:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/dba947cdec61f910166ea5e74073c13f.js></script><br></p><ul><li>RabbitMQ node container:</li></ul><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/5deb5c83cc5568046d5a39c81f201d2c.js></script><br>Note that we are overriding RabbitMQ docker imageâs default command with `{ â/bin/bashâ, â-câ, $â(sleep {ContainerStartupDelay} && docker-entrypoint.sh rabbitmq-server) & waitâ }` to delay the startup of the container, but still keep it responsive. More on this later.<br><br><ul><li>Container mounted volumes:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/b0ea32b39923904c7d9ffd34b148c535.js></script><br></p><ul><li>Storage accounts:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/bde8bda973a6b1240f16edf1f800e2ea.js></script><br></p><ul><li>File shares:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/ddfdca26483c2b0643d01c06e2174fc3.js></script><br></p><ul><li>Container ports:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/4eb8ae91fe2897dc85af31876097c7f1.js></script><br></p><ul><li>Virtual networks:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/88576747f1f7a38b6f6203d8cd95e2c4.js></script><br></p><ul><li>Internal virtual network subnets:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/91de7123a929efe5658119d5ace1ff96.js></script><br></p><p>Note that we are creating it with the Microsoft.Storage service endpoint to allow access to storage accounts and the <code>Microsoft.ContainerInstance/containerGroups</code> delegation, which is required for deploying containers into virtual networks.<br><br></p><ul><li>Network profiles, also required for deploying containers into virtual networks:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/c1eb8c3c31e468e508ed3221eb2718d8.js></script><br></p><ul><li>External virtual network subnets:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/408e58ffb4b50035085e23c24a56fb81.js></script><br></p><ul><li>Internal and external virtual networks peering:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/db16c583aff0e1f6f0341582dcaab273.js></script><br></p><ul><li>External virtual network firewalls:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/2e29cbf1a225e41f959318069565c959.js></script><br></p><ul><li>Internal and external virtual networks routing:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/2bf4513f6b04f9f7849ed67e346a62c5.js></script><br></p><ul><li>RabbitMQ nodes DNS records:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/52302a51601ccf79d5c3752ad3c18aed.js></script><br></p><ul><li>RabbitMQ nodes reverse DNS records:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/43a386db10e9e2d7ace1285b7097676e.js></script><br></p><ul><li>Reversing the IP address as required by a reverse PTR record:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/09ea2238eca195165be2a02f0442e5f2.js></script><br></p><ul><li>Firewall IP forwarding rules:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/1bd2098ee4a0430367e3e82ef439b2db.js></script><br></p><ul><li>RabbitMQâs discovery DNS record:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/0b0a892a76284951e150c04edb24a45f.js></script><br></p><ul><li>Global peering of the external virtual networks:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/6954cd03fb2cb5fce759627635198c60.js></script><br></p><ul><li>Global routes for the virtual networks:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/a2e2016ac2a9db7908c5ac6006f19976.js></script><br></p><ul><li>Firewall virtual appliance routes:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/6f98ab784eb3fc2e579dea9ec90a46ab.js></script><br></p><ul><li>Internet outbound routes:</li></ul><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/f1da19e3eb4561cd0fd662eaa3633302.js></script><br></p><p>Now that we can create all the necessary resources, it is time to put it all together inside the empty <code>Stack()</code> method we created earlier:<br><br></p><p><script type=application/javascript src=https://gist.github.com/ItayPodhajcer/31067831e46aac84701661c2dadab99a.js></script><br></p><p>Note that we are using two loops to create the required resources. The first one creates most of the resources (storage, firewall, networks, container, etc.) and the second one creates the DNS A records of the nodes. The second loop combined with the custom container startup command helps us ensure that the nodes will start without failing only when the entire infrastructure is ready.</p><p>This workaround is required because (at the writing of the article) Azure Container Instances do not allow manual allocation of private IP address, and because RabibtMQâs discovery record requires those IPs which are available only after the containers are created, we end up in a chicken-and-the-egg situation. To overcome that, we need to allow the containers to start, but delay the execution of RabbitMQâs startup script without blocking the container and use to our advantage the fact that RabbitMQ doesnât start when it canât resolve its own hostname (that is why we create those DNS records last).</p><h2 id=deploying-the-stack>Deploying the Stack</h2><p>Once the script is complete, we can call <code>pulumi up --yes</code> to deploy it, where the <code>--yes</code> argument just skips the question whether to deploy or not once Pulumi has built the deployment app and discovered all the resources.</p><p>Remember that you need to call Azure CLI to login to your subscription, so that Pulumi can execute the deployment. You can call <code>az login</code> to login to the Azure portal in an interactive manner.
Checking the Cluster</p><h2 id=checking-the-cluster>Checking the Cluster</h2><p>To check that all nodes have managed to join the cluster we will connect to one of the nodes using <code>az container exec</code> to stream a shell from within that container (see more on the exec command <a href="https://docs.microsoft.com/en-us/cli/azure/container?view=azure-cli-latest#az-container-exec">here</a>).</p><p>Once the shell is connected, you can call <code>rabbitmqctl cluster_status</code> and you should see all three nodes in the printed information.</p><h2 id=conclusion>Conclusion</h2><p>The example in this article can be used as a base for a complete solution, which includes additional containers and managed services provided by Azure. Also, the code for deploying the example, in a real-world scenario, would be better split off to smaller files, as looking at all the code in one large file is overwhelming, therefore harder to maintain.</p></section><section class=py-8><div class="container mx-auto"><div class=text-center><h4>Subscribe to the Pulumi's Monthly Newsletter</h4><div class=inline-block><pulumi-hubspot-form form-id=027b4c6d-9b73-4ad8-b149-3c8b07fff608 class="newsletter newsletter-dark-border"></pulumi-hubspot-form></div></div></div></section><div><ul class="m-0 mt-8 p-0"><li class="mt-0 inline-flex"><a class="tag tag-blog" href=/blog/tag/azure/>azure</a></li><li class="mt-0 inline-flex"><a class="tag tag-blog" href=/blog/tag/.net/>.net</a></li><li class="mt-0 inline-flex"><a class="tag tag-blog" href=/blog/tag/rabbitmq/>rabbitmq</a></li></ul></div></article></div></div><div class="xxl:w-3/12 lg:pl-8"><div class=sticky-sidebar><p class="text-gray-500 text-xs">Share this post</p><ul class="p-0 list-none"><li><a data-track=share-twitter class=mr-2 href="https://twitter.com/intent/tweet?text=Deploy%20a%20Serverless%20RabbitMQ%20Cluster%20on%20Azure%20with%20.NET&tw_p=tweetbutton&url=https%3a%2f%2fwww.pulumi.com%2fblog%2frabbitmq-azure%2f" target=_blank><i class="fab fa-twitter text-xl"></i></a>
<a data-track=share-linkedin href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fwww.pulumi.com%2fblog%2frabbitmq-azure%2f" target=_blank><i class="fab fa-linkedin text-xl"></i></a></li></ul><div class=mt-8><a href=/resources/#upcoming><img src=/images/webinar/pulumi-workshop-ad.png alt="Join an upcoming Pulumi workshop"></a></div></div></div></div></div></main><nav class=footer><div class="w-full h-16 lg:h-32"><div class="dot-background no-animate"></div></div><div class="container mx-auto"><div class=footer-nav-container><div class="hidden md:w-1/12"></div><ul><li><a data-track=footer-get-started href=/docs/get-started/ class=link>Get Started</a></li><li><a data-track=footer-install href=/docs/get-started/install/ class=link>Install</a></li><li><a data-track=footer-documentation href=/docs/reference/ class=link>Documentation</a></li><li><a data-track=footer-apis href=/registry/ class=link>Registry</a></li><li><a data-track=public-roadmap href=https://github.com/orgs/pulumi/projects/44 class=link>Public Roadmap</a></li><li><a data-track=footer-security href=/security/ class=link>Security</a></li></ul><ul><li><a data-track=footer-enterprise href=/enterprise/ class=link>Enterprise</a></li><li><a data-track=footer-aws href=/aws/ class=link>AWS</a></li><li><a data-track=footer-azure href=/azure/ class=link>Azure</a></li><li><a data-track=footer-gcp href=/gcp/ class=link>Google Cloud</a></li><li><a href=/containers/ class=link>Containers</a></li><li><a href=/serverless/ class=link>Serverless</a></li><li><a href=/kubernetes/ class=link>Kubernetes</a></li></ul><ul><li><a data-track=footer-about-us href=/about/ class=link>About Us</a></li><li><a data-track=footer-contact-us href=/contact/ class=link>Contact Us</a></li><li><a data-track=footer-support href=https://support.pulumi.com/ class=link>Support</a></li><li><a data-track=footer-careers href=/careers/ class=link>Careers</a></li></ul><ul><li><a data-track=footer-events href=/resources/ class=link>Resources</a></li><li><a data-track=footer-events href=/case-studies/ class=link>Case Studies</a></li><li><a data-track=footer-events href=/awards/ class=link>Awards & Recognitions</a></li><li><a data-track=footer-brand href=/brand/ class=link>Brand Resources</a></li></ul></div><div class="border my-16"></div><div class=text-center><p class="text-black mb-8">&copy; 2022 Pulumi</p><ul class="flex inline-items text-2xl justify-center"><li class=mr-8><a data-track=footer-twitter href=https://twitter.com/pulumicorp target=_blank><img class=h-6 src=/logos/tech/twitter.svg alt="Pulumi Twitter"></a></li><li class=mr-8><a data-track=footer-slack href=https://slack.pulumi.com/ target=_blank><img class=h-6 src=/logos/tech/slack.svg alt="Pulumi Slack"></a></li><li class=mr-8><a data-track=footer-linkedin href=https://www.linkedin.com/company/pulumi/ target=_blank><img class=h-6 src=/logos/tech/linkedin.svg alt="Pulumi LinkedIn"></a></li><li class=mr-8><a data-track=footer-youtube href=https://www.youtube.com/channel/UC2Dhyn4Ev52YSbcpfnfP0Mw target=_blank><img class=h-6 src=/logos/tech/youtube.svg alt="Pulumi YouTube"></a></li><li><a data-track=footer-github href=https://github.com/pulumi/ target=_blank><img class=h-6 src=/logos/tech/github.svg alt="Pulumi Github"></a></li></ul></div><ul class="py-16 flex flex-col text-center md:text-left md:flex-row md:justify-center"><li class="mr-2 mb-4 lg:mb-0 lg:mr-8 font-semibold"><a class=link data-track=footer-legal-trademark-usage href=/trademark/>Trademark Usage</a></li><li class="mr-2 mb-4 lg:mb-0 lg:mr-8 font-semibold"><a class=link data-track=footer-legal-acceptable-use-policy href=/acceptable-use/>Acceptable Use Policy</a></li><li class="mr-2 mb-4 lg:mb-0 lg:mr-8 font-semibold"><a class=link data-track=footer-legal-terms-conditions href=/terms-and-conditions/>Terms & Conditions</a></li><li class="mr-2 mb-4 lg:mb-0 lg:mr-8 font-semibold"><a class=link data-track=footer-legal-privacy-policy href=/privacy/>Privacy Policy</a></li><li class="mr-2 mb-4 lg:mb-0 lg:mr-8 font-semibold"><a class=link data-track=footer-legal-professional-services-agreement href=/professional-services-agreement/>Professional Services Agreement</a></li></ul></div></nav><noscript><img src=https://ws.zoominfo.com/pixel/61f9917376ed81001a80e653 width=1 height=1 style=display:none></noscript></body></html>