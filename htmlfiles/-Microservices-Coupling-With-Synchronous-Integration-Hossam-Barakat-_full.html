<!DOCTYPE html>
<html lang="en-us">

<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Microservices Coupling With Synchronous Integration &middot; Hossam Barakat
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/site.css">
  <link rel="stylesheet" href="/public/css/font-awesome.min.css">
  <link rel="stylesheet" href="/public/css/prism.css">

  <link href="https://fonts.googleapis.com/css?family=Crimson+Text:400,400i,600,600i|Karla:400,400i,700,700i" rel="stylesheet">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>



<body class="layout-post">
  <header id="masthead" class="site-header">
  <div class="site-header-wrap">
    <div class="site-header-inside">

      <div class="site-branding">

        <p class="profile">
          <a href="/">
            <img
              src="/public/hossambarakat.jpg"
              alt="Hossam Barakat's Picture" class="avatar">
          </a>
        </p>
        <div class="site-identity">
          <h1 class="site-title">
            <a href="/">Hossam Barakat</a>
          </h1>
          <p class="site-description">Software consultant interested in Web development, Microservices, Serverless, and Agile methodologies</p>
        </div>

        <button id="menu-toggle" class="menu-toggle"><span class="screen-reader-text">Main Menu</span><span
            class="icon-menu" aria-hidden="true"></span></button>
      </div><!-- .site-branding -->

      <nav id="main-navigation" class="site-navigation" aria-label="Main Navigation">
        <div class="site-nav-wrap">
          <div class="site-nav-inside">
            <ul class="menu">
              <li class="menu-item"><a href="/">Home</a></li>
              

              
              
                
                  
                
              
                
                  
                
              
                
                  
                    <li class="menu-item "><a href="/about/">About</a></li>
                  
                
              
                
              
                
              
                
                  
                
              
                
                  
                    <li class="menu-item "><a href="/talks/">Talks</a></li>
                  
                
              


            </ul>
            <p class="social-links">

              <a href="https://twitter.com/hossambarakat_" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                  <path
                    d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z">
                  </path>
                </svg>
                <!--
Font Awesome Free 5.5.0 by @fontawesome - https://fontawesome.com
License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
-->
              </a>


              <a href="https://github.com/hossambarakat" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">
                  <path
                    d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
                  </path>
                </svg>
                <!--
Font Awesome Free 5.5.0 by @fontawesome - https://fontawesome.com
License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
-->
              </a>

              <a href="https://au.linkedin.com/in/hossambarakat" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                  <path
                    d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z">
                  </path>
                </svg>
                <!--
Font Awesome Free 5.5.0 by @fontawesome - https://fontawesome.com
License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
-->
              </a>

            </p>
          </div><!-- .site-nav-inside -->
        </div><!-- .site-nav-wrap -->
      </nav><!-- .site-navigation -->

    </div><!-- .site-header-inside -->
  </div><!-- .site-header-wrap -->
</header>

  <div id="content" class="site-content fadeInDown delay_075s">
    <div class="inner-wide">
      <main id="main" class="site-main">
        <!-- <div class="hero inner">
          <p class="hero-text">Hi there! My name is Hossam.</p>
        </div> -->
        <div class="post">
  <header class="post-header">
    <div class="post-meta">
      <time class="published">11 Nov 2017</time>
    </div>
    <h2 class="post-title">
      <a href="/2017/11/11/microservices-coupling-with-synchronous-integration/" rel="bookmark">Microservices Coupling With Synchronous Integration</a>
    </h2>
    <div class="post-tags">
      
      Microservices
      
    </div>
  </header>


  <p>A lot of companies have started the journey of splitting their current monolithic applications into Microservices to gain all the benefits from Microservices such as strong module boundaries, independent deployment, hybrid technologies… which is fine, but what I am concerned about the assumption of splitting monolothic application to microservice will automatically lead to a loosely coupled services.</p>

<p>Let’s start with a simple piece of code handles purchasing command that includes create an order, then start the shipping process:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">PurchaseCommand</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">OrderItem</span><span class="p">&gt;</span> <span class="n">Items</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">Address</span> <span class="n">ShippingAddress</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="c1">//rest of command properties</span>
<span class="p">}</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">PurchaseCommandHandler</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">PurchaseCommand</span> <span class="n">command</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">using</span><span class="p">(</span><span class="kt">var</span> <span class="n">transactionScope</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TransactionScope</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="nf">SaveOrderInDB</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
            <span class="nf">SaveShippingInDB</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now, we decide that this code should be split into two microservices “Orders” and “Shipping” and each one will be hosted in a separate process. but how the two microservices will communicate to each other?</p>

<h2 id="rest">REST</h2>
<p>Usually the answer is using REST for integration between services, so the “Shipping” service will expose an end point that could be called by “Orders” service:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//Shipping Service</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">StartShippingCommand</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">Guid</span> <span class="n">OrderId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">OrderItem</span><span class="p">&gt;</span> <span class="n">Items</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">StartShippingCommandHandler</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">StartShippingCommand</span> <span class="n">command</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">SaveShippingInDB</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The orders service will be updated to make a call to the shipping endpoint:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//Orders Service</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">PurchaseCommandHandler</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">PurchaseCommand</span> <span class="n">command</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">SaveOrderInDB</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">shippingServiceProxy</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ShippingServiceProxy</span><span class="p">();</span>
        <span class="n">shippingServiceProxy</span><span class="p">.</span><span class="nf">StartShipping</span><span class="p">(</span><span class="k">new</span> <span class="nf">StartShippingCommand</span><span class="p">(){});</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>So we managed to split the code into two separate services that could be deployed independently…but are the services loosely coupled?</p>

<blockquote>
  <p><em>Autonomous</em> microservice is a service that can respond to client requests regardless of the availablity of other services…to an extent.</p>
</blockquote>

<h3 id="what-will-happen-if-the-shipping-service-is-not-available">What will happen if the shipping service is not available?</h3>
<p>The orders service will save the order in the DB but will fail while calling the shipping and the whole purchase will fail, moreover our database will be left with data inconsistencies.</p>

<p>So, Although the “Orders” and “Shipping” services are now hosted in two separate processes they are still coupled because the “Orders” service will not be able to serve the client request unless the “Shipping” service is available.</p>

<p>So how could we remove the coupling?</p>

<h2 id="event-driven-integration">Event-Driven Integration</h2>
<p>Event-driven integration means the communication between services done though events, service will publish an event when something notable happens and then other services could subscribe to the event and do its own logic which could result in publishing more events.</p>

<p>So in our scenario, Event-driven integrations means that “Orders” service will save the order in the database then public an event <code class="language-plaintext highlighter-rouge">OrderAccepted</code>, the “Shipping” service will subscribe to <code class="language-plaintext highlighter-rouge">OrderAccepted</code> event and will save the shipping information in the database:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//Orders Service</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">OrderAccepted</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">Guid</span> <span class="n">OrderId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">OrderItem</span><span class="p">&gt;</span> <span class="n">Items</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">PurchaseCommandHandler</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">PurchaseCommand</span> <span class="n">command</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">SaveOrderInDB</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
        <span class="n">Bus</span><span class="p">.</span><span class="nf">Publish</span><span class="p">(</span><span class="k">new</span> <span class="n">OrderAccepted</span>
        <span class="p">{</span>
            <span class="n">OrderId</span> <span class="p">=</span> <span class="n">OrderId</span><span class="p">,</span> 
            <span class="n">Items</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">OrderItem</span><span class="p">&gt;(</span><span class="n">command</span><span class="p">.</span><span class="n">Items</span><span class="p">)</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//Shipping Service</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">StartShippingCommandHandler</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">OrderAccepted</span> <span class="n">@event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">SaveShippingInDB</span><span class="p">(</span><span class="n">@event</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The “Shipping” service could publish another event called <code class="language-plaintext highlighter-rouge">ShippingStarted</code> so “Orders” service could update the the order status.</p>

<h3 id="again-what-will-happen-if-the-shipping-service-unavailable">Again, what will happen if the “Shipping” service unavailable?</h3>
<p>The “Orders” service now can serve the requests while “Shipping” service is down because it can save the data in database then publish an event and respond immediately to the client. the published <code class="language-plaintext highlighter-rouge">OrdeAccepted</code> event will be processed by the “Shipping” service whenever it is available.</p>

<p>Ofcourse that is assuming that the events has been published successfully inside the bus/queue.</p>

<h2 id="summary">Summary</h2>
<p>Decomposing a monolithic application into a set of services hosted in different processes doesn’t guarantee having a loosely coupled microservices. Synchronous communication between microservices will lead to a more coupled microservices however using asynchronous event-driven communication will help in leading to more autonomous loosely coupled microservices.</p>


  <div id="disqus_thread"></div>
</div>

      </main>
    </div>
  </div>

  <script>
      (function(document) {
        var toggle = document.querySelector('.menu-toggle');
        var sidebar = document.querySelector('#masthead');

        toggle.addEventListener('click', function(e) {
          var body = document.querySelector('body');
          body.classList.toggle('menu--opened');
        }, false);
      })(document);
</script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  if(window.location.pathname.startsWith('/p/')===false){
        ga('create', 'UA-58114460-2', 'auto');
  		ga('send', 'pageview');
}
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'hossambarakat'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


<script type="text/javascript" src="/public/js/prism.js"></script>


</body>

</html>
