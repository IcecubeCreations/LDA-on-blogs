
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="This article aims to teach techniques to help with the challenging task of making data between microservices in distributed systems eventually consistent.">
  <meta name="keywords" content="Database, data, microservice, Data consistency, Architecture, event">

  <meta property="og:description" content="This article aims to teach techniques to help with the challenging task of making data between microservices in distributed systems eventually consistent.">
  <meta property="og:site_name" content="dzone.com">
  <meta property="og:title" content="Data Consistency in Microservices Architecture - DZone Microservices">
  <meta property="og:url" content="https://dzone.com/articles/data-consistency-in-microservices-architecture">
  <meta property="og:image" content="https://dz2cdn1.dzone.com/storage/article-thumb/10234492-thumb.jpg">
  <meta property="og:type" content="article">

  <meta name="twitter:site" content="@DZoneInc">
  <meta name="twitter:image" content="https://dz2cdn1.dzone.com/storage/article-thumb/10234492-thumb.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:description" content="This article aims to teach techniques to help with the challenging task of making data between microservices in distributed systems eventually consistent.">
  <meta name="twitter:title" content="Data Consistency in Microservices Architecture - DZone Microservices">

  <meta name="referrer" content="origin-when-cross-origin">
  <meta name="google-site-verification" content="kndbhxcupfEqWmZclhCpB6vlgOs7QSmx2UHAGGnP2mA">
  <meta name="df-verify" content="df0d76632b4543">

  <link rel="icon" type="image/x-icon" href="https://dz2cdn1.dzone.com/themes/dz20/images/favicon.png">
  <link rel="image_src" href="https://dz2cdn1.dzone.com/storage/article-thumb/10234492-thumb.jpg">
  <link rel="canonical" href="https://dzone.com/articles/data-consistency-in-microservices-architecture">

  <title>Data Consistency in Microservices Architecture - DZone Microservices</title>

  <link rel="preload" href="https://fonts.dzone.com/themes/dz20/font/fontello.woff?11773374" as="font" type="font/woff" crossorigin="anonymous">

  <link rel="stylesheet" media="all" href="https://dz2cdn1.dzone.com/themes/dz20/ftl/icons.css">
  <link rel="stylesheet" media="all" href="https://dz2cdn1.dzone.com/themes/dz20/lib/static/bootstrap/bootstrap.min.css">
  <link rel="stylesheet" media="all" href="https://dz2cdn1.dzone.com/themes/dz20/ftl/article/global.css">
  <link rel="stylesheet" media="all" href="https://dz2cdn1.dzone.com/themes/dz20/ftl/header/styles.css">
</head>
<body>
<div id="ftl-header">
  <div class="container-fluid header">
    <div class="row">
      <div class="col-md-12" style="padding: 0;">
        <div class="header-top">
          <div class="header-container">
            <div class="pull-left logo-container">
              <div class="logo">
                <a class="inner" href="/">
                  <picture>
                    <source srcset="https://dz2cdn1.dzone.com/themes/dz20/images/dz_logo_2021_cropped.webp" type="image/webp">
                    <source srcset="https://dz2cdn1.dzone.com/themes/dz20/images/dz_logo_2021_cropped.png" type="image/png">
                    <img src="https://dz2cdn1.dzone.com/themes/dz20/images/dz_logo_2021_cropped.png" width="160" height="52" alt="DZone">
                  </picture>
                </a>
              </div>

                <div class="active-portal"><a href="/microservices-news-tutorials-tools">Microservices Zone</a></div>
            </div>

            <div class="pull-right login-and-search">
              <div id="authenticated-block" class="logged-in">
                <div class="welcome-back">Thanks for visiting DZone today,</div>
                <div id="user-header" class="user-info">
                  <button class="user-avatar">
                    <span id="header-username" class="username"></span>
                    <img id="header-avatar" src="" alt="user avatar">
                  </button>
                  <div id="user-dropdown" class="browse-user-menu">
                    <div class="user-content">
                      <a id="header-user-plug" href="#" class="user-description"></a>
                      <a id="header-user-edit" href="#" class="edit-profile">Edit Profile</a>
                    </div>
                    <ul class="user-actions">
                      <li id="first-user-action"><a id="header-dropdown-manage-email" href="#">Manage Email Subscriptions</a></li>
                      <li>
                        <a href="/articles/how-to-submit-a-post-to-dzone?utm_source=DZone&utm_medium=user_dropdown&utm_campaign=how_to_post">
                          How to Post to DZone
                        </a>
                      </li>
                      <li>
                        <a href="/articles/dzones-article-submission-guidelines">
                          Article Submission Guidelines
                        </a>
                      </li>
                    </ul>
                    <div class="bottom">
                      <a href="/users/logout.html" class="sign-out">Sign Out</a>
                      <a id="dropdown-view-profile" href="#" class="view-profile">View Profile</a>
                    </div>
                  </div>
                </div>

                <div class="post-content">
                  <button id="post-button" class="post-content--button">
                    <span class="post-class">Post</span>
                    <i class="icon-plus"></i>
                  </button>

                  <div id="post-menu" class="posting-links">
                    <div class="posting-links-menu">
                      <ul>
                        <li>
                          <img src="/themes/dz20/images/dz-postarticle.svg">
                          <a href="/content/article/post.html">Post an Article</a>
                        </li>
                        <li>
                          <a id="drafts-link" href="#">Manage My Drafts</a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

              <div id="unauthenticated-block">
                <div class="dz-intro">Over 2 million developers have joined DZone.</div>
                <div class="mobile-invisible sign-in-join">
                  <a href="/users/login.html">Log In</a>
                  <span class="dz-intro-span">/</span>
                  <a href="/static/registration.html">Join</a>
                </div>
                <a class="join-icon" href="/users/login.html"><i class="icon-user"></i></a>
              </div>
              <div class="headerSearch">
                <a class="icon-search dropdown-toggle" href="/search"></a>
              </div>
            </div>
          </div>
        </div>

        <div class="header-bottom">


          <ul class="portals header-container scrollable-ul">
            <li>
              <a href="/refcardz" id="header-refcardz">
                <em>Refcardz</em>
              </a>
            </li>
            <li>
              <a href="/trendreports" id="header-research">
                <em>Trend Reports</em>
              </a>
            </li>
            <li>
              <a href="/webinars" id="header-webinars">
                <em>Webinars</em>
              </a>
            </li>
            <li class="last-portal-link">
              <a href="#" id="header-portals">
                <em>
                  Zones
                  <span id="zone-arrow" class="collapsible-toggle">
                    <i class="icon-angle-down"></i>
                    <i class="icon-angle-up"></i>
                  </span>
                </em>
              </a>
            </li>

            <li class="separator" aria-hidden="true" style="color: #d9dcdd;">|</li>
            <li id="portal-list" class="portal-topics">
              <ul>
                  <li>
                    <a href="/agile-methodology-training-tools-news" id="header-2">Agile</a>
                  </li>
                  <li>
                    <a href="/artificial-intelligence-tutorials-tools-news" id="header-4001">AI</a>
                  </li>
                  <li>
                    <a href="/big-data-analytics-tutorials-tools-news" id="header-3">Big Data</a>
                  </li>
                  <li>
                    <a href="/cloud-computing-tutorials-tools-news" id="header-4">Cloud</a>
                  </li>
                  <li>
                    <a href="/database-sql-nosql-tutorials-tools-news" id="header-5">Database</a>
                  </li>
                  <li>
                    <a href="/devops-tutorials-tools-news" id="header-6">DevOps</a>
                  </li>
                  <li>
                    <a href="/enterprise-integration-training-tools-news" id="header-7">Integration</a>
                  </li>
                  <li>
                    <a href="/iot-developer-tutorials-tools-news-reviews" id="header-8">IoT</a>
                  </li>
                  <li>
                    <a href="/java-jdk-development-tutorials-tools-news" id="header-1">Java</a>
                  </li>
                  <li>
                    <a href="/microservices-news-tutorials-tools" id="header-6001">Microservices</a>
                  </li>
                  <li>
                    <a href="/open-source-news-tutorials-tools" id="header-7001">Open Source</a>
                  </li>
                  <li>
                    <a href="/apm-tools-performance-monitoring-optimization" id="header-10">Performance</a>
                  </li>
                  <li>
                    <a href="/application-web-network-security" id="header-2001">Security</a>
                  </li>
                  <li>
                    <a href="/web-development-programming-tutorials-tools-news" id="header-11">Web Dev</a>
                  </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script async src="https://dz2cdn1.dzone.com/themes/dz20/ftl/header/bundle.js"></script><link rel="stylesheet" media="all" href="https://dz2cdn1.dzone.com/themes/dz20/ftl/article/styles.css">




<div id="ftl-article" >
  <div class="container-fluid body">
    <div class="row">
      <div class="col-md-12">
        <div class="articles-wrap">
              <div class="ad-container">
                <div id="div-gpt-ad-1435246566686-0" class="ads-billboard-article" data-gpt-slot="top"></div>
              </div>


          <div class="article-stream widget-top-border">
                <div class="content-right-images">
                  <div id="div-gpt-ad-1435246566686-2" class="sidebar-ad" data-gpt-desktop="true" data-gpt-slot="sidebar1"></div>
                </div>

                <script type="application/ld+json">
                  {
                    "@context": "http://schema.org",
                    "@type": "Article",
                    "headline": "Data Consistency in Microservices Architecture",
                    "author": {
                      "@type": "Person",
                      "name": "Grygoriy Gonchar"
                    },
                    "audience": "software developers",
                    "keywords": "microservices,data,data consistency,software architecture,distributed systems,tutorial",
                    "timeRequired": "PT9M",
                    "commentCount": 0,
                    "wordCount": "2133",
                    "accessMode": "textual, visual",
                    "dateCreated": "2018-09-17T13:31:08Z",
                    "datePublished": "2018-09-17T00:00:00Z",
                    "dateModified": "2018-09-17T13:31:08Z",
                    "articleSection": "microservices-news-tutorials-tools",
                    "publisher": {
                      "@type": "Organization",
                      "name": "DZone",
                      "url": "https://dzone.com",
                      "logo": {
                        "@type": "ImageObject",
                        "url": "https://dzone.com/themes/dz20/images/dz_logo_2021_cropped.png"
                      }
                    },
                    "articleBody": "In microservices, one logically atomic operation can frequently span multiple microservices. Even a monolithic system might use multiple databases or messaging solutions. With several independent data storage solutions, we risk inconsistent data if one of the distributed process participants fails — such as charging a customer without placing the order or not notifying the customer that the order succeeded. Distributed process failures: In this article, I’d like to share some of the techniques I’ve learned for making data between microservices eventually consistent. Why is it so challenging to achieve this? As long as we have multiple places where the data is stored (which are not in a single database), consistency is not solved automatically and engineers need to take care of consistency while designing the system. For now, in my opinion, the industry doesn’t yet have a widely known solution for updating data atomically in multiple different data sources — and we probably shouldn’t wait for one to be available soon. One attempt to solve this problem in an automated and hassle-free manner is the XA protocol implementing the two-phase commit (2PC) pattern. But in modern high-scale applications (especially in a cloud environment), 2PC doesn’t seem to perform so well. To eliminate the disadvantages of 2PC, we have to trade ACID for BASE and cover consistency concerns ourselves in different ways depending on the requirements. Saga Pattern The most well-known way of handling consistency concerns in multiple microservices is the Saga Pattern. You may treat Sagas as application-level distributed coordination of multiple transactions. Depending on the use-case and requirements, you optimize your own Saga implementation. In contrast, the XA protocol tries to cover all the scenarios. The Saga Pattern is also not new. It was known and used in ESB and SOA architectures in the past. Finally, it successfully transitioned to the microservices world. Each atomic business operation that spans multiple services might consist of multiple transactions on a technical level. The key idea of the Saga Pattern is to be able to roll back one of the individual transactions. As we know, rollback is not possible for already committed individual transactions out of the box. But this is achieved by invoking a compensation action — by introducing a “Cancel” operation. Compensating operations: In addition to cancelation, you should consider making your service idempotent, so you can retry or restart certain operations in case of failures. Failures should be monitored and reaction to failures should be proactive. Reconciliation What if in the middle of the process the system responsible for calling a compensation action crashes or restarts. In this case, the user may receive an error message and the compensation logic should be triggered or — when processing asynchronous user requests, the execution logic should be resumed. Main process failure: To find crashed transactions and resume operation or apply compensation, we need to reconcile data from multiple services. Reconciliation is a technique familiar to engineers who have worked in the financial domain. Did you ever wonder how banks make sure your money transfer didn’t get lost or how money transfer happens between two different banks in general? The quick answer is reconciliation. In accounting, reconciliation is the process of ensuring that two sets of records (usually the balances of two accounts) are in agreement. Reconciliation is used to ensure that the money leaving an account matches the actual money spent. This is done by making sure the balances match at the end of a particular accounting period.  —  Jean Scheid, “Understanding Balance Sheet Account Reconciliation,” Bright Hub, 8 April 2011 Coming back to microservices, using the same principle we can reconcile data from multiple services on some action trigger. Actions could be triggered on a scheduled basis or by a monitoring system when failure is detected. The simplest approach is to run a record-by-record comparison. This process could be optimized by comparing aggregated values. In this case, one of the systems will be a source of truth for each record. Event Log Imagine multistep transactions. How to determine during reconciliation which transactions might have failed and which steps have failed? One solution is to check the status of each transaction. In some cases, this functionality is not available (imagine a stateless mail service that sends email or produces other kinds of messages). In some other cases, you might want to get immediate visibility on the transaction state, especially in complex scenarios with many steps. For example, a multistep order with booking flights, hotels, and transfers. Complex distributed process: In these situations, an event log can help. Logging is a simple but powerful technique. Many distributed systems rely on logs. “Write-ahead logging” is how databases achieve transactional behavior or maintain consistency between replicas internally. The same technique could be applied to microservices design. Before making an actual data change, the service writes a log entry about its intent to make a change. In practice, the event log could be a table or a collection inside a database owned by the coordinating service. Sample event log: The event log could be used not only to resume transaction processing but also to provide visibility to system users, customers, or to the support team. However, in simple scenarios a service log might be redundant and status endpoints or status fields be enough. Orchestration vs. Choreography By this point, you might think sagas are only a part of orchestration scenarios. But sagas can be used in choreography as well, where each microservice knows only a part of the process. Sagas include the knowledge on handling both positive and negative flows of distributed transaction. In choreography, each of the distributed transaction participants has this kind of knowledge. Single-Write With Events The consistency solutions described so far are not easy. They are indeed complex. But there is a simpler way: modifying a single datasource at a time. Instead of changing the state of the service and emitting the event in one process, we could separate those two steps. Change-First In a main business operation, we modify our own state of the service while a separate process reliably captures the change and produces the event. This technique is known as Change Data Capture (CDC). Some of the technologies implementing this approach are Kafka Connect or Debezium. Change Data Capture with Debezium and Kafka Connect: However, sometimes no specific framework is required. Some databases offer a friendly way to tail their operations log, such as MongoDB Oplog. If there is no such functionality in the database, changes can be polled by timestamp or queried with the last processed ID for immutable records. The key to avoiding inconsistency is making the data change notification a separate process. The database record is, in this case, the single source of truth. A change is only captured if it happened in the first place. Change Data Capture without specific tools: The biggest drawback of change data capture is the separation of business logic. Change capture procedures will most likely live in your codebase separate from the change logic itself — which is inconvenient. The most well-known application of change data capture is domain-agnostic change replication such as sharing data with a data warehouse. For domain events, it’s better to employ a different mechanism such as sending events explicitly. Event-First Let’s look at the single source of truth upside down. What if instead of writing to the database first we trigger an event instead and share it with ourselves and with other services. In this case, the event becomes the single source of truth. This would be a form of event-sourcing where the state of our own service effectively becomes a read model and each event is a write model. Event-first approach: On the one hand, it’s a command query responsibility segregation (CQRS) pattern where we separate the read and write models, but CQRS by itself doesn’t focus on the most important part of the solution — consuming the events with multiple services. In contrast, event-driven architectures focus on events consumed by multiple systems but don’t emphasize the fact that events are the only atomic pieces of data update. So I’d like to introduce “event-first” as a name to this approach: updating the internal state of the microservice by emitting a single event — both to our own service and any other interested microservices. The challenges with an “event-first” approach are also the challenges of CQRS itself. Imagine that before making an order we want to check item availability. What if two instances concurrently receive an order of the same item? Both will concurrently check the inventory in a read model and emit an order event. Without some sort of covering scenario, we could run into troubles. The usual way to handle these cases is optimistic concurrency: to place a read model version into the event and ignore it on the consumer side if the read model was already updated on the consumer side. The other solution would be using pessimistic concurrency control, such as creating a lock for an item while we check its availability. The other challenge of the “event-first” approach is a challenge of any event-driven architecture — the order of events. Processing events in the wrong order by multiple concurrent consumers might give us another kind of consistency issue, for example processing an order of a customer who hasn’t been created yet. Data streaming solutions such as Kafka or AWS Kinesis can guarantee that events related to a single entity will be processed sequentially (such as creating an order for a customer only after the user is created). In Kafka for example, you can partition topics by user ID so that all events related to a single user will be processed by a single consumer assigned to the partition, thus allowing them to be processed sequentially. In contrast, in Message Brokers, message queues have an order but multiple concurrent consumers make message processing in a given order hard, if not impossible. In this case, you could run into concurrency issues. In practice, an “event-first” approach is hard to implement in scenarios when linearizability is required or in scenarios with many data constraints such as uniqueness checks. But it really shines in other scenarios. However, due to its asynchronous nature, challenges with concurrency and race conditions still need to be addressed. Consistency by Design There many ways to split the system into multiple services. We strive to match separate microservices with separate domains. But how granular are the domains? Sometimes it’s hard to differentiate domains from subdomains or aggregation roots. There is no simple rule to define your microservices split. Rather than focusing only on domain-driven design, I suggest to be pragmatic and consider all the implications of the design options. One of those implications is how well microservices isolation aligns with the transaction boundaries. A system where transactions only reside within microservices doesn’t require any of the solutions above. We should definitely consider the transaction boundaries while designing the system. In practice, it might be hard to design the whole system in this manner, but I think we should aim to minimize data consistency challenges. Accepting Inconsistency While it’s crucial to match the account balance, there are many use cases where consistency is much less important. Imagine gathering data for analytics or statistics purposes. Even if we lose 10% of data from the system randomly, most likely the business value from analytics won’t be affected. Sharing data with events: Which Solution to Choose Atomic update of data requires a consensus between two different systems, an agreement if a single value is 0 or 1. When it comes to microservices, it comes down to the problem of consistency between two participants and all practical solutions follow a single rule of thumb: In a given moment, for each data record, you need to find which data source is trusted by your system. The source of truth could be events, the database or one of the services. Achieving consistency in microservice systems is the developers’ responsibility. My approach is the following: Try to design a system that doesn’t require distributed consistency. Unfortunately, that’s barely possible for complex systems. Try to reduce the number of inconsistencies by modifying one data source at a time. Consider event-driven architecture. A big strength of event-driven architecture in addition to loose coupling is a natural way of achieving data consistency by having events as a single source of truth or producing events as a result of change data capture. More complex scenarios might still require synchronous calls between services, failure handling, and compensations. Know that sometimes you may have to reconcile afterward. Design your service capabilities to be reversible, decide how you will handle failure scenarios and achieve consistency early in the design phase. I will be sharing more thoughts on this topic at Voxxed Days Microservices in Paris. Join us!",
                    "mainEntityOfPage": {
                      "@type": "WebPage",
                      "@id": "https://dzone.com/articles/data-consistency-in-microservices-architecture"
                    },
                    "image": {
                      "@type": "ImageObject",
                      "url": "https://dzone.com//dz2cdn1.dzone.com/storage/article-thumb/10234492-thumb.jpg"
                    }
                  }
                </script>

                  <script type="application/ld+json">
                    {
                      "@context": "https://schema.org",
                      "@type": "BreadcrumbList",
                      "itemListElement": [{
                        "@type": "ListItem",
                        "position": 1,
                        "name": "DZone",
                        "item": "https://dzone.com"
                      }, {
                        "@type": "ListItem",
                        "position": 2,
                        "name": "Microservices Zone",
                        "item": "https://dzone.com/microservices-news-tutorials-tools"
                      }, {
                        "@type": "ListItem",
                        "position": 3,
                        "name": "Data Consistency in Microservices Architecture",
                        "item": "https://dzone.com/articles/data-consistency-in-microservices-architecture"
                      }]
                    }
                  </script>

            <article>
              <div class="content">
                <div class="header">
                  <div class="col-xs-12 breadcrumb-padding">
                    <a href="/">DZone</a>
                    >
                      <a href="/microservices-news-tutorials-tools">Microservices Zone</a>
                      >
                      <a href="#">Data Consistency in Microservices Architecture</a>
                  </div>


                  <div class="header-title">
                    <div class="title">
                      <h1 class="article-title">Data Consistency in Microservices Architecture</h1>
                    </div>

                    <div class="subhead">
                      <h3>Learn techniques to help with the challenging task of making data between microservices eventually consistent.</h3>
                    </div>

                    <div class="publish-meta">
                        <div class="article-author-meta">
                          <img src="https://dz2cdn3.dzone.com/thumbnail?fid=3596575&w=80" class="avatar" alt="Grygoriy Gonchar user avatar" width="40">
                          by

                          <div class="author-info">
                            <span class="author-name">
                              <a href="/users/1442443/Grygoriy_Gonchar.html" rel="nofollow">Grygoriy Gonchar</a>
                            </span>
                          </div>


                            <div class="mvb-award">
                              <i title="Most Valuable Blogger" class="icon-mvb-1"></i>
                            </div>


                          &middot;
                        </div>
                      <span class="author-date">
                        Sep. 17, 18
                      </span>
                      &middot;
                        <a href="/microservices-news-tutorials-tools" id="portal-name">
                          <span class="portal-name">Microservices Zone</span>
                        </a>
                      &middot;
                      <span>Tutorial</span>
                    </div>
                  </div>
                </div>

                <div class="author-n-useraction">
                  <div class="like action">
                    <div id="activity-like-icon" class="dz-like icon-thumbs-up">
                      <span class="action-label">
                        <span id="activity-like-text">Like</span>
                      </span>
                      <a href="#">
                        <span id="activity-like-counter">(25)</span>
                      </a>
                    </div>
                  </div>

                  <div class="action">

                    <button class="comment">
                      <i class="icon-comment"></i>
                      Comment
                      <span id="activity-comment-counter" class="comment-count"></span>
                    </button>
                  </div>

                  <div class="save action">
                    <div id="activity-save-icon" class="save icon-star-empty">
                      <span id="activity-save-text" class="action-label">Save</span>
                    </div>
                  </div>

                  <div class="tweet action">
                    <a id="tweet-link" href="" class="title" target="_blank">
                      <span><i class="icon-twitter"></i></span>
                      <span class="action-label">Tweet</span>
                    </a>
                  </div>

                  <div class="pull-right">
                    <div id="activity-view-container" class="article-views action">
                      <i class="icon-eye"></i> 73.33K
                      <span class="action-label">Views</span>
                    </div>
                  </div>
                </div>

                    <div class="signin-prompt">
                      <p>Join the DZone community and get the full member experience.</p>
                      <a id="article-signin-prompt" href="/static/registration.html">Join For Free</a>
                    </div>
                    <div class="arrow-down"></div>

                  <div id="top-bumper-container"></div>

                <div>
                  <div class="content-html"><section name="a0fd"> 
 <p style="text-align: left;">In microservices, one logically atomic operation can frequently span multiple microservices. Even a monolithic system might use multiple databases or messaging solutions. With several independent data storage solutions, we risk inconsistent data if one of the distributed process participants fails — such as charging a customer without placing the order or not notifying the customer that the order succeeded.</p> 
 <section name="a0fd"> 
  <figure id="9db2" name="9db2"> 
   <figcaption> 
    <strong>Distributed process failures:</strong> 
   </figcaption> 
  </figure> 
 </section> 
 <figure name="9db2" id="9db2"> 
  <img data-src="https://cdn-images-1.medium.com/max/1600/1*M8lIZ7A4UMy3L1Ofb_gmdA.png" src="https://cdn-images-1.medium.com/max/1600/1*M8lIZ7A4UMy3L1Ofb_gmdA.png" class="fr-fin fr-dib" width="767" /> 
 </figure> 
 <p style="text-align: left;">In this article, I’d like to share some of the techniques I’ve learned for making data between microservices <a data-href="https://www.allthingsdistributed.com/2008/12/eventually_consistent.html" href="https://www.allthingsdistributed.com/2008/12/eventually_consistent.html" rel="noopener" target="_blank">eventually consistent</a>.</p> 
 <p style="text-align: left;">Why is it so challenging to achieve this? As long as we have multiple places where the data is stored (which are not in a single database), consistency is not solved automatically and engineers need to take care of consistency while designing the system. For now, in my opinion, the industry doesn’t yet have a widely known solution for updating data atomically in multiple different data sources — and we probably shouldn’t wait for one to be available soon.</p> 
 <p style="text-align: left;">One attempt to solve this problem in an automated and hassle-free manner is the <a data-href="https://en.wikipedia.org/wiki/X/Open_XA" href="https://en.wikipedia.org/wiki/X/Open_XA" rel="noopener" target="_blank">XA protocol</a> implementing the <a data-href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" rel="noopener" target="_blank">two-phase commit (2PC) pattern</a>. But in modern high-scale applications (especially in a cloud environment), 2PC doesn’t seem to perform so well. To eliminate the disadvantages of 2PC, we have to trade <a data-href="https://en.wikipedia.org/wiki/ACID_(computer_science)" href="https://en.wikipedia.org/wiki/ACID_%28computer_science%29" rel="noopener" target="_blank">ACID</a> for <a data-href="https://neo4j.com/blog/acid-vs-base-consistency-models-explained/" href="https://neo4j.com/blog/acid-vs-base-consistency-models-explained/" rel="noopener" target="_blank">BASE</a> and cover consistency concerns ourselves in different ways depending on the requirements.</p> 
</section> 
<section name="f400"> 
 <h2 name="f94d" id="f94d" style="text-align: left;">Saga Pattern</h2> 
 <p style="text-align: left;">The most well-known way of handling consistency concerns in multiple microservices is the <a data-href="http://microservices.io/patterns/data/saga.html" href="http://microservices.io/patterns/data/saga.html" rel="noopener" target="_blank">Saga Pattern</a>. You may treat Sagas as application-level distributed coordination of multiple transactions. Depending on the use-case and requirements, you optimize your own Saga implementation. In contrast, the XA protocol tries to cover all the scenarios. The Saga Pattern is also not new. It was known and used in ESB and SOA architectures in the past. Finally, it successfully transitioned to the microservices world. Each atomic business operation that spans multiple services might consist of multiple transactions on a technical level. The key idea of the Saga Pattern is to be able to roll back one of the individual transactions. As we know, rollback is not possible for already committed individual transactions out of the box. But this is achieved by invoking a compensation action — by introducing a “Cancel” operation.</p> 
 <p><strong>Compensating operations:</strong></p> 
 <figure name="b0a1" id="b0a1"> 
  <img data-src="https://cdn-images-1.medium.com/max/1600/1*Ro2X-BkhkXrbhAfMYVe0Ig.png" src="https://cdn-images-1.medium.com/max/1600/1*Ro2X-BkhkXrbhAfMYVe0Ig.png" class="fr-fin fr-dib" /> 
 </figure> 
 <p style="text-align: left;">In addition to cancelation, you should consider making your service idempotent, so you can retry or restart certain operations in case of failures. Failures should be monitored and reaction to failures should be proactive.</p> 
 <h3 name="ad48" id="ad48" style="text-align: left;">Reconciliation</h3> 
 <p style="text-align: left;">What if in the middle of the process the system responsible for calling a compensation action crashes or restarts. In this case, the user may receive an error message and the compensation logic should be triggered or — when processing asynchronous user requests, the execution logic should be resumed.</p> 
 <p><br /></p> 
 <section name="f400"> 
  <figure id="c1f5" name="c1f5"> 
   <figcaption> 
    <strong>Main process failure:</strong> 
   </figcaption> 
  </figure> 
 </section> 
 <p><br /></p> 
 <figure name="c1f5" id="c1f5"> 
  <img data-src="https://cdn-images-1.medium.com/max/1600/1*itV1h1UYW9FxxLFhuAp2EQ.png" src="https://cdn-images-1.medium.com/max/1600/1*itV1h1UYW9FxxLFhuAp2EQ.png" class="fr-dii fr-fil" /> 
  <figcaption> 
   <br /> 
  </figcaption> 
 </figure> 
 <p style="text-align: left;">To find crashed transactions and resume operation or apply compensation, we need to reconcile data from multiple services. Reconciliation is a technique familiar to engineers who have worked in the financial domain. Did you ever wonder how banks make sure your money transfer didn’t get lost or how money transfer happens between two different banks in general? The quick answer is reconciliation.</p> 
 <figure name="a9b8" id="a9b8"> 
  <img data-src="https://cdn-images-1.medium.com/max/1600/1*Ir33gJ2hMKhwsO5H1nJC9w.png" src="https://cdn-images-1.medium.com/max/1600/1*Ir33gJ2hMKhwsO5H1nJC9w.png" class="fr-fin fr-dib" /> 
 </figure> 
 <blockquote name="ec69" id="ec69" style="text-align: left;"> 
  <em> In accounting, reconciliation is the process of ensuring that two sets of records (usually the balances of two accounts) are in agreement. Reconciliation is used to ensure that the money leaving an account matches the actual money spent. This is done by making sure the balances match at the end of a particular accounting period.&nbsp;</em> —  Jean Scheid, “Understanding Balance Sheet Account Reconciliation,” Bright Hub, 8 April 2011 
 </blockquote> 
 <p style="text-align: left;">Coming back to microservices, using the same principle we can reconcile data from multiple services on some action trigger. Actions could be triggered on a scheduled basis or by a monitoring system when failure is detected. The simplest approach is to run a record-by-record comparison. This process could be optimized by comparing aggregated values. In this case, one of the systems will be a <em>source of truth</em> for each record<em>.</em></p> 
 <h3 name="584f" id="584f" style="text-align: left;">Event Log</h3> 
 <p style="text-align: left;">Imagine multistep transactions. How to determine during reconciliation which transactions might have failed and which steps have failed? One solution is to check the status of each transaction. In some cases, this functionality is not available (imagine a stateless mail service that sends email or produces other kinds of messages). In some other cases, you might want to get immediate visibility on the transaction state, especially in complex scenarios with many steps. For example, a multistep order with booking flights, hotels, and transfers.</p> 
 <p><br /></p> 
 <section name="f400"> 
  <figure id="d444" name="d444"> 
   <figcaption> 
    <strong>Complex distributed process:</strong> 
   </figcaption> 
  </figure> 
 </section> 
 <p><br /></p> 
 <figure name="d444" id="d444"> 
  <img data-src="https://cdn-images-1.medium.com/max/1600/1*0z0qha3vDNRQ0XJJtID9GA.png" src="https://cdn-images-1.medium.com/max/1600/1*0z0qha3vDNRQ0XJJtID9GA.png" class="fr-fin fr-dib" /> 
  <figcaption> 
   <br /> 
  </figcaption> 
 </figure> 
 <p style="text-align: left;">In these situations, an event log can help. Logging is a simple but powerful technique. Many distributed systems rely on logs. “<a data-href="https://en.wikipedia.org/wiki/Write-ahead_logging" href="https://en.wikipedia.org/wiki/Write-ahead_logging" rel="noopener" target="_blank">Write-ahead logging</a>” is how databases achieve transactional behavior or maintain consistency between replicas internally. The same technique could be applied to microservices design. Before making an actual data change, the service writes a log entry about its intent to make a change. In practice, the event log could be a table or a collection inside a database owned by the coordinating service.</p> 
 <p><br /></p> 
 <section name="f400"> 
  <figure id="5d95" name="5d95"> 
   <figcaption> 
    <strong>Sample event log:</strong> 
   </figcaption> 
  </figure> 
 </section> 
 <p><br /></p> 
 <figure name="5d95" id="5d95"> 
  <img data-src="https://cdn-images-1.medium.com/max/1600/1*Mf8akQgDOc1bZSLHr5ASzw.png" src="https://cdn-images-1.medium.com/max/1600/1*Mf8akQgDOc1bZSLHr5ASzw.png" class="fr-fin fr-dib" /> 
  <figcaption> 
   <br /> 
  </figcaption> 
 </figure> 
 <p style="text-align: left;">The event log could be used not only to resume transaction processing but also to provide visibility to system users, customers, or to the support team. However, in simple scenarios a service log might be redundant and status endpoints or status fields be enough.</p> 
 <h3 name="c689" id="c689" style="text-align: left;">Orchestration vs. Choreography</h3> 
 <p style="text-align: left;">By this point, you might think sagas are only a part of orchestration scenarios. But sagas can be used in choreography as well, where each microservice knows only a part of the process. Sagas include the knowledge on handling both positive and negative flows of distributed transaction. In choreography, each of the distributed transaction participants has this kind of knowledge.</p> 
</section> 
<section name="1d77"> 
 <h3 name="eb1a" id="eb1a" style="text-align: left;">Single-Write With Events</h3> 
 <p style="text-align: left;">The consistency solutions described so far are not easy. They are indeed complex. But there is a simpler way: <em>modifying a single datasource at a time. </em>Instead of changing the state of the service and emitting the event in one process, we could separate those two steps.</p> 
 <h4 name="bd09" id="bd09" style="text-align: left;">Change-First</h4> 
 <p style="text-align: left;">In a main business operation, we modify our own state of the service while a separate process reliably captures the change and produces the event. This technique is known as <em>Change Data Capture (CDC)</em>. Some of the technologies implementing this approach are <a data-href="https://docs.confluent.io/current/connect/index.html" href="https://docs.confluent.io/current/connect/index.html" rel="noopener" target="_blank">Kafka Connect</a> or <a data-href="https://debezium.io/" href="https://debezium.io/" rel="noopener" target="_blank">Debezium</a>.</p> 
 <p><br /></p> 
 <section name="1d77"> 
  <figure id="f0ce" name="f0ce"> 
   <figcaption> 
    <strong>Change Data Capture with Debezium and Kafka Connect:</strong> 
   </figcaption> 
  </figure> 
 </section> 
 <p><br /></p> 
 <figure name="f0ce" id="f0ce"> 
  <img data-src="https://cdn-images-1.medium.com/max/1600/1*ZeI8U6mqdBZmZDarj6DqBQ.png" src="https://cdn-images-1.medium.com/max/1600/1*ZeI8U6mqdBZmZDarj6DqBQ.png" class="fr-fin fr-dib" /> 
  <figcaption> 
   <br /> 
  </figcaption> 
 </figure> 
 <p style="text-align: left;">However, sometimes no specific framework is required. Some databases offer a friendly way to tail their operations log, such as <a data-href="https://docs.mongodb.com/manual/core/replica-set-oplog/" href="https://docs.mongodb.com/manual/core/replica-set-oplog/" rel="noopener" target="_blank">MongoDB Oplog</a>. If there is no such functionality in the database, changes can be polled by timestamp or queried with the last processed ID for immutable records. The key to avoiding inconsistency is making the data change notification a separate process. The database record is, in this case, the <em>single source of truth</em>. A change is only captured if it happened in the first place.</p> 
 <p><br /></p> 
 <section name="1d77"> 
  <figure id="bd4b" name="bd4b"> 
   <figcaption> 
    <strong>Change Data Capture without specific tools:</strong> 
   </figcaption> 
  </figure> 
 </section> 
 <p><br /></p> 
 <figure name="bd4b" id="bd4b"> 
  <img data-src="https://cdn-images-1.medium.com/max/1600/1*2LIDFfCoKRf7arteACtUsQ.png" src="https://cdn-images-1.medium.com/max/1600/1*2LIDFfCoKRf7arteACtUsQ.png" class="fr-fin fr-dib" /> 
  <figcaption> 
   <br /> 
  </figcaption> 
 </figure> 
 <p style="text-align: left;">The biggest drawback of change data capture is the separation of business logic. Change capture procedures will most likely live in your codebase separate from the change logic itself — which is inconvenient. The most well-known application of change data capture is domain-agnostic change replication such as sharing data with a data warehouse. For domain events, it’s better to employ a different mechanism such as sending events explicitly.</p> 
 <h4 name="a63f" id="a63f" style="text-align: left;">Event-First</h4> 
 <p style="text-align: left;">Let’s look at the <em>single source of truth</em> upside down. What if instead of writing to the database first we trigger an event instead and share it with ourselves and with other services. In this case, the event becomes the<em> single source of truth</em>. This would be a form of event-sourcing where the state of our own service effectively becomes a read model and each event is a write model.</p> 
 <section name="1d77"> 
  <figure id="24f2" name="24f2"> 
   <figcaption> 
    <strong>Event-first approach:</strong> 
   </figcaption> 
  </figure> 
 </section> 
 <p><br /></p> 
 <figure name="24f2" id="24f2"> 
  <img data-src="https://cdn-images-1.medium.com/max/1600/1*Y5-KTK3OhFiNBFnB0GZukQ.png" src="https://cdn-images-1.medium.com/max/1600/1*Y5-KTK3OhFiNBFnB0GZukQ.png" class="fr-fin fr-dib" /> 
 </figure> 
 <p style="text-align: left;">On the one hand, it’s a command query responsibility segregation (CQRS) pattern where we separate the read and write models, but CQRS by itself doesn’t focus on the most important part of the solution — consuming the events with multiple services.</p> 
 <p style="text-align: left;">In contrast, event-driven architectures focus on events consumed by multiple systems but don’t emphasize the fact that events are the only atomic pieces of data update. So I’d like to introduce “e<em>vent-first” </em>as a name to this approach: updating the internal state of the microservice by emitting a single event — both to our own service and any other interested microservices.</p> 
 <p style="text-align: left;">The challenges with an “event-first” approach are also the challenges of CQRS itself. Imagine that before making an order we want to check item availability. What if two instances concurrently receive an order of the same item? Both will concurrently check the inventory in a read model and emit an order event. Without some sort of covering scenario, we could run into troubles.</p> 
 <p style="text-align: left;">The usual way to handle these cases is optimistic concurrency: to place a read model version into the event and ignore it on the consumer side if the read model was already updated on the consumer side. The other solution would be using pessimistic concurrency control, such as creating a lock for an item while we check its availability.</p> 
 <p style="text-align: left;">The other challenge of the “event-first” approach is a challenge of any event-driven architecture — the order of events. Processing events in the wrong order by multiple concurrent consumers might give us another kind of consistency issue, for example processing an order of a customer who hasn’t been created yet.</p> 
 <p style="text-align: left;">Data streaming solutions such as Kafka or AWS Kinesis can guarantee that events related to a single entity will be processed sequentially (such as creating an order for a customer only after the user is created). In Kafka for example, you can partition topics by user ID so that all events related to a single user will be processed by a single consumer assigned to the partition, thus allowing them to be processed sequentially. In contrast, in Message Brokers, message queues have an order but multiple concurrent consumers make message processing in a given order hard, if not impossible. In this case, you could run into concurrency issues.</p> 
 <p style="text-align: left;">In practice, an “event-first” approach is hard to implement in scenarios when <a data-href="https://jepsen.io/consistency/models/linearizable" href="https://jepsen.io/consistency/models/linearizable" rel="noopener" target="_blank">linearizability</a> is required or in scenarios with many data constraints such as uniqueness checks. But it really shines in other scenarios. However, due to its asynchronous nature, challenges with concurrency and race conditions still need to be addressed.</p> 
</section> 
<section name="4e7f"> 
 <h2 name="df87" id="df87" style="text-align: left;">Consistency by Design</h2> 
 <p style="text-align: left;">There many ways to split the system into multiple services. We strive to match separate microservices with separate domains. But how granular are the domains? Sometimes it’s hard to differentiate domains from subdomains or aggregation roots. There is no simple rule to define your microservices split.</p> 
 <p style="text-align: left;">Rather than focusing only on domain-driven design, I suggest to be pragmatic and consider all the implications of the design options. One of those implications is how well microservices isolation aligns with the transaction boundaries. A system where transactions only reside within microservices doesn’t require any of the solutions above. We should definitely consider the transaction boundaries while designing the system. In practice, it might be hard to design the whole system in this manner, but I think we should aim to minimize data consistency challenges.</p> 
 <h3 name="9e79" id="9e79" style="text-align: left;">Accepting Inconsistency</h3> 
 <p style="text-align: left;">While it’s crucial to match the account balance, there are many use cases where consistency is much less important. Imagine gathering data for analytics or statistics purposes. Even if we lose 10% of data from the system randomly, most likely the business value from analytics won’t be affected.</p> 
 <p></p> 
 <section name="4e7f"> 
  <figure id="6d5e" name="6d5e"> 
   <figcaption> 
    <strong>Sharing data with events:</strong> 
   </figcaption> 
  </figure> 
 </section> 
 <p></p> 
 <figure name="6d5e" id="6d5e"> 
  <img data-src="https://cdn-images-1.medium.com/max/1600/1*Ppo0Jq8cpGLiOc-3AuvN6w.png" src="https://cdn-images-1.medium.com/max/1600/1*Ppo0Jq8cpGLiOc-3AuvN6w.png" class="fr-fin fr-dib" /> 
  <figcaption> 
   <br /> 
  </figcaption> 
 </figure> 
 <h3 name="bf5d" id="bf5d" style="text-align: left;">Which Solution to Choose</h3> 
 <p style="text-align: left;">Atomic update of data requires a consensus between two different systems, an agreement if a single value is 0 or 1. When it comes to microservices, it comes down to the problem of consistency between two participants and all practical solutions follow a single rule of thumb: <strong>In a given moment, for each data record, you need to find which data source is trusted by your system.</strong></p> 
 <p style="text-align: left;">The source of truth could be events, the database or one of the services. Achieving consistency in microservice systems is the developers’ responsibility. My approach is the following:</p> 
 <ol> 
  <li name="c760" id="c760" style="text-align: left;">Try to design a system that doesn’t require distributed consistency. Unfortunately, that’s barely possible for complex systems.</li> 
  <li name="21e6" id="21e6" style="text-align: left;">Try to reduce the number of inconsistencies by modifying one data source at a time.</li> 
  <li name="d089" id="d089" style="text-align: left;">Consider event-driven architecture. A big strength of event-driven architecture in addition to loose coupling is a natural way of achieving data consistency by having events as a single source of truth or producing events as a result of change data capture.</li> 
  <li name="a56c" id="a56c" style="text-align: left;">More complex scenarios might still require synchronous calls between services, failure handling, and compensations. Know that sometimes you may have to reconcile afterward.</li> 
  <li name="2d83" id="2d83" style="text-align: left;">Design your service capabilities to be reversible, decide how you will handle failure scenarios and achieve consistency early in the design phase.</li> 
 </ol> 
 <p style="text-align: left;"><em>I will be sharing more thoughts on this topic at <a data-action="show-user-card" data-action-type="hover" data-action-value="1e0d868c066c" data-anchor-type="2" data-href="https://medium.com/@voxxed" data-user-id="1e0d868c066c" href="https://medium.com/@voxxed" target="_blank">Voxxed&nbsp;</a>Days Microservices in Paris.&nbsp;</em><em>Join us!</em></p> 
</section></div>
                </div>

                  <div id="bottom-bumper-container"></div>
                  <div class="article-tag-pill-container">
                      <span class="article-tag-pill">Database</span>
                      <span class="article-tag-pill">Data (computing)</span>
                      <span class="article-tag-pill">microservice</span>
                      <span class="article-tag-pill">Data consistency</span>
                      <span class="article-tag-pill">Architecture</span>
                      <span class="article-tag-pill">Event</span>
                  </div>

                  <div class="attribution">
                    <p>Opinions expressed by DZone contributors are their own.</p>
                  </div>

                    <div class="related">
                      <h3>Popular on DZone</h3>
                        <ul>
                            <li class="relateddiv">
                              <a href="/articles/pulumi-vs-terraform?fromrel=true">Why I'm Choosing Pulumi Over Terraform</a>
                            </li>
                            <li class="relateddiv">
                              <a href="/articles/10-cloud-platforms-for-internet-of-things-iot?fromrel=true">Top 11 Cloud Platforms for Internet of Things (IoT)</a>
                            </li>
                            <li class="relateddiv">
                              <a href="/articles/after-inspection-comes-adaptation-how-to-do-action?fromrel=true">After Inspection, Comes Adaptation: How to Do Action-Based Retrospectives Right</a>
                            </li>
                            <li class="relateddiv">
                              <a href="/articles/cypress-the-future-of-test-automation-advantages-a?fromrel=true">Cypress: The Future of Test Automation! Advantages and Disadvantages</a>
                            </li>
                        </ul>
                      </div>
<div class="comments-overlay"></div>
<div id="comment-box">
  <div class="comment-box-wrapper">
    <div id="comment-input-editor"></div>
  </div>
  <div class="info hidden"></div>
  <div class="comments-content">
    <div class="comment-header">
      <hr />
      <span class="icon-comment">
        <span class="numOfComments"></span> Comments
      </span>
    </div>
    <div class="comments"></div>
  </div>
</div>
            </article>
          </div>

            <div id="above-pr-ad" class="bottom-ad-container">
              <div id="div-gpt-ad-1435246566686-11" data-gpt-slot="bottom"></div>
            </div>
            <div class="layout-card widget-top-border partner-resources-block" style="width:100%; margin-bottom: 1em;">
              <div class="main-container">
                <div class="featured-header">
                  <h2>
                      Microservices<span> Partner Resources</span>
                  </h2>
                </div>
                <div class="partner-resources-container">
                  <div id="div-gpt-ad-1435246566686-5" class="resource-block" data-gpt-slot="partner" data-gpt-position="pr1"></div>
                  <div id="div-gpt-ad-1435246566686-6" class="resource-block" data-gpt-slot="partner" data-gpt-position="pr2"></div>
                  <div id="div-gpt-ad-1435246566686-7" class="resource-block" data-gpt-slot="partner" data-gpt-position="pr3"></div>
                </div>
              </div>
            </div>
        </div>
      </div>
    </div>
  </div>

    <div id="bsa-parent" class="bottom-sticky-ad-container hide">
      <div class="container">
        <div class="col-md-9">
          <div class="fixed-bottom-div">
            <div class="inline-block">
              <div id="div-gpt-ad-1635294790718-12" data-gpt-desktop="true" class="bottom-sticky-ad"></div>
            </div>
            <div class="inline-block">
              <span id="close" class="bottom-sticky-ad-close-button" onclick="removeBottomStickyAd()">
                X
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

  <div class="modal fade bd-example-modal-lg" id="modal-message" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"></div>
        <div class="modal-body"></div>
      </div>
    </div>
  </div>
</div>

<script async>const articleTitle = 'Data Consistency in Microservices Architecture'
const articleUrl = 'https://dzone.com/articles/data-consistency-in-microservices-architecture'

const retweetLink = document.querySelector('#tweet-link')

function retweet(event) {
    event.preventDefault()
    event.stopPropagation()

    const twitter = 'https://twitter.com/intent/tweet'
    const params = '?text=' + encodeURIComponent(articleTitle) + '&url=' + articleUrl + '&ref=dzone.com&via=DZoneInc'
    const win = window.open(twitter + params, '_blank')
    win.focus()
}

retweetLink.addEventListener('click', retweet);

function showStatusMessage(options) {
  var modal = document.getElementById("modal-message");

  if(modal) {
    modal.classList.add(options.type);
    var modalBody = modal.querySelector(".modal-content .modal-body");
    var modalHeader = modal.querySelector(".modal-content .modal-header");

    modalHeader.innerText = options.header ? options.header : "";
    modalBody.innerText = options.body ? options.body : "" ;

    $(modal).modal("show");

    $(modal).on('hidden.bs.modal', function () {
      modal.classList.remove(options.type);
    });
  }
}

function showConfirmMessage(options) {
  var modal = document.getElementById("modal-message");

  if(modal) {
    modal.classList.add(options.type);
    var modalBody = modal.querySelector(".modal-content .modal-body");
    var modalHeader = modal.querySelector(".modal-content .modal-header");

    modalHeader.innerText = options.header ? options.header : "";
    modalBody.innerText = options.body ? options.body : "" ;

    if (options.textarea) {
      const textareaDiv = document.createElement('div')
      const textareaLabel = document.createElement('label')
      textareaLabel.setAttribute('for', 'modal-textarea')
      textareaLabel.innerText = options.textarea.label

      const textarea = document.createElement('textarea')
      textarea.id = 'modal-textarea'
      textarea.placeholder = (options.textarea.placeholder || '')
      textarea.setAttribute('rows', (options.textarea.rows || 3))
      textarea.classList.add('form-control', 'not-resizable')

      if (options.textarea.maxlength) {
        textarea.maxLength = options.textarea.maxlength
      }

      textareaDiv.appendChild(textareaLabel)
      textareaDiv.appendChild(textarea)
      modalBody.appendChild(textareaDiv)
    }

    var btnContainer = document.createElement("div");
    btnContainer.classList.add("btn-container");

    var noBtn = document.createElement("button");
    noBtn.innerText = options.noBtnText ? options.noBtnText : "No";
    noBtn.classList.add("no-btn");

    var yesBtn = document.createElement("button");
    yesBtn.innerText = options.yesBtnText ? options.yesBtnText : "Yes";
    yesBtn.classList.add("yes-btn");

    btnContainer.appendChild(noBtn);
    btnContainer.appendChild(yesBtn);

    modalBody.appendChild(btnContainer);

    $(modal).modal("show");

    $(noBtn).one("click", function() {
      $(modal).modal("hide");

      if(options.noCallback) {
        $(modal).one('hidden.bs.modal', function () {
          options.noCallback();
        });
      }
    });

    $(yesBtn).one("click", function() {
      $(modal).modal("hide");

      if(options.yesCallback) {
        $(modal).one('hidden.bs.modal', function () {
          options.yesCallback();
        });
      }
    });

    $(modal).on('hidden.bs.modal', function () {
      modal.classList.remove(options.type);
    });
  }
}
</script><link rel="stylesheet" media="all" href="https://dz2cdn1.dzone.com/themes/dz20/ftl/footer/styles.css">

<div id="ftl-footer">
  <div class="container-fluid footerOuter">
    <div class="row">
      <div class="col-md-12">
        <div class="container">
          <div class="row footer">
            <div class="col-md-12 footerWidget">
              <div class="row footerContainer footer">
                <div class="left col-xs-12 col-sm-7">
                  <div class="col-xs-12 social-media-icons footer-mobile">
                    <ul class="icons-only">
                      <li class="rss-icon" id="rss-footer-1">
                        <a href="/pages/feeds" target="_blank" rel="noreferrer noopener">
                          <i class="icon-rss-1"></i>
                        </a>
                      </li>
                      <li class="twitter-icon">
                        <a href="https://twitter.com/DZoneInc" target="_blank" rel="noreferrer noopener">
                          <i class="icon-twitter"></i>
                        </a>
                      </li>
                      <li class="facebook-icon">
                        <a href="https://www.facebook.com/DZoneInc" target="_blank" rel="noreferrer noopener">
                          <i class="icon-facebook-1"></i>
                        </a>
                      </li>
                      <li class="linkedin-icon">
                        <a href="https://www.linkedin.com/company/dzone/" target="_blank"
                           rel="noreferrer noopener">
                          <i class="icon-linkedin-1"></i>
                        </a>
                      </li>
                    </ul>
                  </div>

                  <div class="top-section col-xs-12">
                    <div class="col-xs-12 col-sm-6">
                      <p class="section-header">ABOUT US</p>
                      <ul class="link-group">
                        <li><a href="/pages/about" rel="noreferrer noopener">About DZone</a></li>
                        <li><a href="mailto:support@dzone.com" rel="noreferrer noopener">Send feedback</a></li>
                        <li><a href="https://careers.dzone.com/" target="_blank" rel="noreferrer noopener">Careers</a></li>
                          <li><a href="/sitemap" rel="noreferrer noopener">Sitemap</a></li>
                      </ul>
                    </div>
                    <div class="col-xs-12 col-sm-6">
                      <p class="section-header">ADVERTISE</p>
                      <ul class="link-group">
                        <li><a href="https://advertise.dzone.com" target="_blank" rel="noreferrer noopener">Advertise with DZone</a></li>
                      </ul>
                    </div>
                  </div>

                  <div class="bottom-section col-xs-12">
                    <div class="col-xs-12 col-sm-6">
                      <p class="section-header">CONTRIBUTE ON DZONE</p>
                      <ul class="bottom-top-list link-group">
                        <li><a href="/articles/dzones-article-submission-guidelines">Article Submission Guidelines</a></li>
                        <li><a href="/pages/mvb" rel="noreferrer noopener">MVB Program</a></li>
                        <li><a href="/pages/contribute" rel="noreferrer noopener">Become a Contributor</a></li>
                        <li><a href="/writers-zone" rel="noreferrer noopener">Visit the Writers' Zone</a></li>
                      </ul>

                      <p class="section-header">LEGAL</p>
                      <ul class="link-group">
                        <li><a href="/pages/tos" rel="noreferrer noopener">Terms of Service</a></li>
                        <li><a href="/pages/privacy" rel="noreferrer noopener">Privacy Policy</a></li>
                      </ul>
                    </div>
                    <div class="col-xs-12 col-sm-6">
                      <p class="section-header">CONTACT US</p>
                      <ul class="link-group">
                        <li>600 Park Offices Drive</li>
                        <li>Suite 300</li>
                        <li>Durham, NC 27709</li>
                        <li><a href="mailto:support@dzone.com" rel="noreferrer noopener">support@dzone.com</a></li>
                        <li><a href="tel:+19196780300" rel="noreferrer noopener">+1 (919) 678-0300</a></li>
                      </ul>
                    </div>
                  </div>
                </div>

                <div class="right col-xs-12 col-sm-5">

                  <p class="connect-text">Let's be friends:</p>
                  <div class="col-xs-12 social-media-icons footer-wide">
                    <ul class="icons-only">
                      <li class="rss-icon" id="rss-footer-1">
                        <a href="/pages/feeds" target="_blank" rel="noreferrer noopener">
                          <i class="icon-rss-1"></i>
                        </a>
                      </li>
                      <li class="twitter-icon">
                        <a href="https://twitter.com/DZoneInc" target="_blank" rel="noreferrer noopener">
                          <i class="icon-twitter"></i>
                        </a>
                      </li>
                      <li class="facebook-icon">
                        <a href="https://www.facebook.com/DZoneInc" target="_blank" rel="noreferrer noopener">
                          <i class="icon-facebook-1"></i>
                        </a>
                      </li>
                      <li class="linkedin-icon">
                        <a href="https://www.linkedin.com/company/dzone/" target="_blank"
                           rel="noreferrer noopener">
                          <i class="icon-linkedin-1"></i>
                        </a>
                      </li>
                    </ul>
                  </div>

                  <div class="col-xs-12 powered-by">
                    <p>DZone.com is powered by&nbsp;</p>
                    <a href="https://devada.com/answerhub/" rel="noreferrer noopener">
                      <img src=""
                           data-src="https://dz2cdn1.dzone.com/themes/dz20/images/answerhub_logo_white_footer.png"
                           width="150"
                           height="56"
                           class="lazyload"
                           alt="AnswerHub logo">
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>

  <script async>
      (function(w, d, s, l, i) {
          w[l] = w[l] || [];
          w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
          var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
          j.async = true;
          j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
          f.parentNode.insertBefore(j,f);
      })(window, document, 'script', 'dataLayer', 'GTM-K25QL22');
  </script>

  <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-410289-1', 'auto');
      ga('require', 'linkid', 'linkid.js');
      ga('require', 'GTM-TSD9TZP');
      ga('set', 'siteSpeedSampleRate', 25);
  </script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>
  <script async>const analytics = {
    'dimension1': 'microservices',
    'dimension2': 'article/tutorial',
    'dimension3': '2018-09-17',
    'dimension4': '0',
    'dimension5': '',
    'dimension7': 'Database, data, microservice, Data consistency, Architecture, event',
    'dimension8': 'Grygoriy_Gonchar',
    'dimension9': 'undefined',
    'dimension10': 'eBay'
}

if (window.ga) {
    Object.keys(analytics).forEach(function(key) {
        window.ga('set', key, analytics[key])
    })

    window.ga('send', 'pageview')
}</script>

  <script>
      !function (e, o, n, i) {
          if (!e) {
              e = e || {}, window.permutive = e, e.q = [];
              var t = function () {
                  return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, function (e) {
                      return (e ^ (window.crypto || window.msCrypto).getRandomValues(new Uint8Array(1))[0] & 15 >> e / 4).toString(16)
                  })
              };
              e.config = i || {}, e.config.apiKey = o, e.config.workspaceId = n, e.config.environment = e.config.environment || "production", (window.crypto || window.msCrypto) && (e.config.viewId = t());
              for (var g = ["addon", "identify", "track", "trigger", "query", "segment", "segments", "ready", "on", "once", "user", "consent"], r = 0; r < g.length; r++) {
                  var w = g[r];
                  e[w] = function (o) {
                      return function () {
                          var n = Array.prototype.slice.call(arguments, 0);
                          e.q.push({
                              functionName: o,
                              arguments: n
                          })
                      }
                  }(w)
              }
          }
      }(window.permutive, "bca90777-e088-4f2a-96c2-13ad18deeccc", "18ad0c5b-460c-4d19-a729-dc537805538f", {});
      window.googletag = window.googletag || {}, window.googletag.cmd = window.googletag.cmd || [], window.googletag.cmd.push(function () {
          if (0 === window.googletag.pubads().getTargeting("permutive").length) {
              var e = window.localStorage.getItem("_pdfps");
              window.googletag.pubads().setTargeting("permutive", e ? JSON.parse(e) : []);
              var o = window.localStorage.getItem("permutive-id");
              o && (window.googletag.pubads().setTargeting("puid", o), window.googletag.pubads().setTargeting("ptime", Date.now().toString())), window.permutive.config.viewId && window.googletag.pubads().setTargeting("prmtvvid", window.permutive.config.viewId), window.permutive.config.workspaceId && window.googletag.pubads().setTargeting("prmtvwid", window.permutive.config.workspaceId)
          }
      });


      permutive.addon('web', {
          'page': {
              'category': 'Microservices',
              'node': {
                  'authorCompany': 'eBay',
                  'authors': [1442443, ],
                  'publishDate': new Date(1537142400000),
                  'sponsorAuthor': false,
                  'tags': ['Database', 'data', 'microservice', 'Data consistency', 'Architecture', 'event', ],
                  'title': 'Data Consistency in Microservices Architecture',
                  'type': 'article',
              },
              'section': 'article',
          }
      });
  </script>
  <script async src="https://18ad0c5b-460c-4d19-a729-dc537805538f.edge.permutive.app/18ad0c5b-460c-4d19-a729-dc537805538f-web.js"></script>

  <script>
      const csrf = '1441517685147025253'
      const articleId = 2450725
      const likes = 25
      const assetDomain = 'https://dz2cdn1.dzone.com'
      const codemirrorVars = {
          modeURI: 'https://dz2cdn1.dzone.com/themes/dz20/lib/codemirror/mode/',
          requiredScripts: [
              'https://dz2cdn1.dzone.com/themes/dz20/lib/codemirror/lib/codemirror.js',
              'https://dz2cdn1.dzone.com/themes/dz20/lib/codemirror/mode/meta.js'
          ]
      }

      const gptTags = {
          'zone': 'microservices',
          'topicTag': 'Database,data,microservice,Data consistency,Architecture,event',
          'company': '',
          'siteSection': 'Zones',
          'articleCategory': 'tutorial',
          'nodeID': '2450725',
          'authorID': '1442443',
          'publishYear': '2018',
          'publishMonth': '09',
          'jobRole': '',
          'companySize': ''
      }

      const minCommentChar = 10;
      const peer39Enabled = true;
  </script>

  <script src="https://dz2cdn1.dzone.com/themes/dz20/lib/static/jquery/jquery.min.js"></script>
  <script async src="https://dz2cdn1.dzone.com/themes/dz20/lib/static/bootstrap/bootstrap.min.js"></script>
  <script async src="https://dz2cdn1.dzone.com/themes/dz20/ftl/article/ads.js"></script>



  <script>
      function loadScript(src) {
          return new Promise(function (resolve, reject) {
              const s = document.createElement('script')
              s.src = src
              s.onload = resolve
              s.onerror = reject
              document.head.appendChild(s)
          })
      }

      function loadStyle(href) {
          const link = document.createElement('link')
          link.rel = 'stylesheet'
          link.href = href
          document.head.appendChild(link)
      }

      function loadScriptsSync(deferred) {
          var p = Promise.resolve()
          for (var i = 0; i < deferred.length; i++) {
              let script = deferred[i]
              p = p.then(function() {
                  return loadScript(script)
              })
          }
          return p
      }

      function loadStyles() {
          const deferred = [
              'https://dz2cdn1.dzone.com/themes/dz20/lib/codemirror/lib/codemirror.css',
              'https://dz2cdn1.dzone.com/themes/dz20/ftl/comments/styles.css',
              'https://dz2cdn1.dzone.com/themes/dz20/lib/froala3/css/froala_editor.pkgd.min.css',
              'https://dz2cdn1.dzone.com/themes/dz20/lib/froala3/css/themes/gray.min.css',
              'https://dz2cdn1.dzone.com/themes/dz20/ftl/article/mini-profile.css'
          ]

          for (var i = 0; i < deferred.length; i++) {
              loadStyle(deferred[i])
          }
      }

      window.addEventListener('load', function(event) {
          loadStyles()
          loadScriptsSync([
              'https://dz2cdn1.dzone.com/themes/dz20/ftl/header/auth-status.js',
              'https://dz2cdn1.dzone.com/themes/dz20/lib/lazysizes.min.js',
              'https://dz2cdn1.dzone.com/themes/dz20/ftl/article/codeblocks.js',
              'https://dz2cdn1.dzone.com/themes/dz20/ftl/article/activity-bar.js',
              'https://dz2cdn1.dzone.com/themes/dz20/lib/froala3/js/froala_editor.pkgd.min.js',
              'https://dz2cdn1.dzone.com/themes/dz20/ftl/froala/content.js',
              'https://dz2cdn1.dzone.com/themes/dz20/ftl/comments/content.js',
              'https://dz2cdn1.dzone.com/themes/dz20/ftl/article/content.js'
          ])
      })
  </script>
</body>
</html>